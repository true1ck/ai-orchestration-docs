<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Autonomous Agent Factory — Build System Architecture</title>
    <link
        href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;500;600&family=IBM+Plex+Sans:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <style>
        :root {
            --bg: #080c10;
            --surface: #0d1117;
            --surface2: #161b22;
            --surface3: #1c2433;
            --border: #21262d;
            --border2: #30363d;
            --text: #e6edf3;
            --muted: #7d8590;
            --dim: #484f58;

            /* Agent colors */
            --orch: #f0e68c;
            /* gold */
            --arch: #79c0ff;
            /* blue */
            --back: #7ee787;
            /* green */
            --front: #d2a8ff;
            /* purple */
            --test: #ffa657;
            /* orange */
            --sec: #ff7b72;
            /* red */
            --doc: #a5d6ff;
            /* light blue */
            --review: #ffb3d1;
            /* pink */
            --human: #ffffff;
            /* white */
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: var(--bg);
            color: var(--text);
            font-family: 'IBM Plex Sans', sans-serif;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Scanline effect */
        body::before {
            content: '';
            position: fixed;
            inset: 0;
            background: repeating-linear-gradient(0deg,
                    transparent,
                    transparent 2px,
                    rgba(0, 0, 0, 0.03) 2px,
                    rgba(0, 0, 0, 0.03) 4px);
            pointer-events: none;
            z-index: 999;
        }

        .wrap {
            max-width: 1400px;
            margin: 0 auto;
            padding: 48px 32px;
        }

        /* ── HEADER ── */
        .hdr {
            margin-bottom: 64px;
            animation: rise 0.5s ease;
        }

        .hdr-top {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            border-bottom: 1px solid var(--border2);
            padding-bottom: 24px;
            margin-bottom: 24px;
        }

        .hdr-badge {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 11px;
            color: var(--orch);
            border: 1px solid rgba(240, 230, 140, 0.3);
            padding: 4px 10px;
            margin-bottom: 16px;
            display: inline-block;
            letter-spacing: 2px;
        }

        .hdr h1 {
            font-size: clamp(28px, 4vw, 52px);
            font-weight: 700;
            line-height: 1.05;
            letter-spacing: -0.5px;
        }

        .hdr h1 .hi {
            color: var(--orch);
        }

        .hdr-right {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 11px;
            color: var(--muted);
            line-height: 2;
            text-align: right;
            flex-shrink: 0;
        }

        .hdr-sub {
            font-size: 15px;
            color: var(--muted);
            max-width: 700px;
            line-height: 1.65;
        }

        .hdr-sub strong {
            color: var(--text);
            font-weight: 500;
        }

        /* ── SECTION ── */
        .sec {
            margin-bottom: 64px;
            animation: rise 0.5s ease both;
        }

        .sec:nth-child(2) {
            animation-delay: 0.05s;
        }

        .sec:nth-child(3) {
            animation-delay: 0.1s;
        }

        .sec:nth-child(4) {
            animation-delay: 0.15s;
        }

        .sec:nth-child(5) {
            animation-delay: 0.2s;
        }

        .sec:nth-child(6) {
            animation-delay: 0.25s;
        }

        .sec-title {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 11px;
            letter-spacing: 3px;
            text-transform: uppercase;
            color: var(--muted);
            margin-bottom: 24px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .sec-title span {
            color: var(--orch);
        }

        .sec-title::after {
            content: '';
            flex: 1;
            height: 1px;
            background: var(--border2);
        }

        /* ── PHILOSOPHY BOX ── */
        .philosophy {
            background: var(--surface2);
            border: 1px solid var(--border2);
            border-left: 3px solid var(--orch);
            border-radius: 6px;
            padding: 28px 32px;
            margin-bottom: 40px;
        }

        .philosophy h3 {
            font-size: 13px;
            font-weight: 600;
            color: var(--orch);
            letter-spacing: 1px;
            margin-bottom: 16px;
            font-family: 'IBM Plex Mono', monospace;
        }

        .phil-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .phil-item h4 {
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 6px;
        }

        .phil-item p {
            font-size: 12px;
            color: var(--muted);
            line-height: 1.6;
        }

        /* ── MAIN FLOW DIAGRAM ── */
        .flow-diagram {
            background: var(--surface);
            border: 1px solid var(--border2);
            border-radius: 8px;
            padding: 40px;
            overflow-x: auto;
        }

        .flow-label {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 10px;
            color: var(--dim);
            letter-spacing: 2px;
            text-align: center;
            margin-bottom: 32px;
        }

        /* Big orchestrator */
        .orch-box {
            background: rgba(240, 230, 140, 0.07);
            border: 2px solid rgba(240, 230, 140, 0.4);
            border-radius: 8px;
            padding: 20px 28px;
            text-align: center;
            max-width: 420px;
            margin: 0 auto 8px;
            position: relative;
            animation: pulse-glow 4s ease-in-out infinite;
        }

        @keyframes pulse-glow {

            0%,
            100% {
                box-shadow: 0 0 0 0 rgba(240, 230, 140, 0.15);
            }

            50% {
                box-shadow: 0 0 32px 4px rgba(240, 230, 140, 0.12);
            }
        }

        .orch-box .label {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 10px;
            color: rgba(240, 230, 140, 0.5);
            letter-spacing: 2px;
            margin-bottom: 6px;
        }

        .orch-box .title {
            font-size: 16px;
            font-weight: 600;
            color: var(--orch);
            margin-bottom: 4px;
        }

        .orch-box .detail {
            font-size: 11px;
            color: var(--muted);
            font-family: 'IBM Plex Mono', monospace;
        }

        /* Human checkpoint */
        .human-node {
            background: rgba(255, 255, 255, 0.05);
            border: 2px dashed rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            padding: 14px 20px;
            text-align: center;
            max-width: 200px;
            margin: 0 auto 8px;
            transition: border-color 0.2s;
        }

        .human-node:hover {
            border-color: rgba(255, 255, 255, 0.6);
        }

        .human-node .label {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 9px;
            color: rgba(255, 255, 255, 0.4);
            letter-spacing: 2px;
            margin-bottom: 4px;
        }

        .human-node .title {
            font-size: 13px;
            font-weight: 500;
            color: white;
        }

        .human-node .detail {
            font-size: 10px;
            color: rgba(255, 255, 255, 0.4);
            font-family: 'IBM Plex Mono', monospace;
            margin-top: 3px;
        }

        /* Vertical connector */
        .vc {
            width: 1px;
            height: 28px;
            background: linear-gradient(180deg, var(--border2), rgba(255, 255, 255, 0.15));
            margin: 0 auto;
            position: relative;
        }

        .vc.arrow::after {
            content: '▼';
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 8px;
            color: var(--dim);
        }

        .vc-label {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 9px;
            color: var(--dim);
            text-align: center;
            margin: 2px 0;
            letter-spacing: 1px;
        }

        /* Agent layer */
        .agent-layer {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            justify-content: center;
            margin: 8px 0;
        }

        /* Agent nodes in diagram */
        .ag {
            border: 1px solid;
            border-radius: 6px;
            padding: 12px 16px;
            min-width: 130px;
            text-align: center;
            transition: transform 0.15s, box-shadow 0.15s;
            cursor: default;
        }

        .ag:hover {
            transform: translateY(-3px);
        }

        .ag .ag-icon {
            font-size: 16px;
            margin-bottom: 4px;
        }

        .ag .ag-name {
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 2px;
        }

        .ag .ag-role {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 9px;
            opacity: 0.6;
        }

        .ag.arch {
            border-color: rgba(121, 192, 255, 0.4);
            background: rgba(121, 192, 255, 0.06);
        }

        .ag.back {
            border-color: rgba(126, 231, 135, 0.4);
            background: rgba(126, 231, 135, 0.06);
        }

        .ag.front {
            border-color: rgba(210, 168, 255, 0.4);
            background: rgba(210, 168, 255, 0.06);
        }

        .ag.test {
            border-color: rgba(255, 166, 87, 0.4);
            background: rgba(255, 166, 87, 0.06);
        }

        .ag.sec {
            border-color: rgba(255, 123, 114, 0.4);
            background: rgba(255, 123, 114, 0.06);
        }

        .ag.doc {
            border-color: rgba(165, 214, 255, 0.4);
            background: rgba(165, 214, 255, 0.06);
        }

        .ag.rev {
            border-color: rgba(255, 179, 209, 0.4);
            background: rgba(255, 179, 209, 0.06);
        }

        .ag.arch .ag-name {
            color: var(--arch);
        }

        .ag.back .ag-name {
            color: var(--back);
        }

        .ag.front .ag-name {
            color: var(--front);
        }

        .ag.test .ag-name {
            color: var(--test);
        }

        .ag.sec .ag-name {
            color: var(--sec);
        }

        .ag.doc .ag-name {
            color: var(--doc);
        }

        .ag.rev .ag-name {
            color: var(--review);
        }

        /* MCP tools layer */
        .mcp-layer {
            background: rgba(255, 255, 255, 0.02);
            border: 1px dashed var(--border2);
            border-radius: 8px;
            padding: 16px 20px;
            margin: 8px 0;
        }

        .mcp-title {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 9px;
            color: var(--dim);
            letter-spacing: 2px;
            text-align: center;
            margin-bottom: 12px;
        }

        .mcp-tools {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .mcp-tool {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 10px;
            color: var(--muted);
            background: var(--surface3);
            border: 1px solid var(--border);
            padding: 4px 10px;
            border-radius: 3px;
        }

        /* Output layer */
        .output-layer {
            display: flex;
            gap: 12px;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 8px;
        }

        .out-node {
            background: rgba(126, 231, 135, 0.07);
            border: 1px solid rgba(126, 231, 135, 0.3);
            border-radius: 6px;
            padding: 10px 20px;
            text-align: center;
            font-size: 12px;
            color: var(--back);
            font-weight: 500;
            font-family: 'IBM Plex Mono', monospace;
        }

        /* ── AGENT DETAIL TABLE ── */
        .agent-table {
            width: 100%;
            border-collapse: collapse;
        }

        .agent-table th {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 10px;
            letter-spacing: 2px;
            text-transform: uppercase;
            color: var(--dim);
            border-bottom: 1px solid var(--border2);
            padding: 10px 16px;
            text-align: left;
        }

        .agent-table td {
            padding: 14px 16px;
            border-bottom: 1px solid var(--border);
            font-size: 13px;
            vertical-align: top;
            line-height: 1.6;
        }

        .agent-table tr:hover td {
            background: rgba(255, 255, 255, 0.02);
        }

        .agent-table td:first-child {
            font-size: 15px;
            width: 40px;
        }

        .agent-table td:nth-child(2) {
            font-weight: 600;
            width: 160px;
        }

        .chip {
            display: inline-block;
            font-family: 'IBM Plex Mono', monospace;
            font-size: 10px;
            padding: 2px 7px;
            border-radius: 3px;
            margin: 2px 2px 2px 0;
        }

        .chip-y {
            background: rgba(240, 230, 140, 0.12);
            color: var(--orch);
        }

        .chip-b {
            background: rgba(121, 192, 255, 0.12);
            color: var(--arch);
        }

        .chip-g {
            background: rgba(126, 231, 135, 0.12);
            color: var(--back);
        }

        .chip-p {
            background: rgba(210, 168, 255, 0.12);
            color: var(--front);
        }

        .chip-o {
            background: rgba(255, 166, 87, 0.12);
            color: var(--test);
        }

        .chip-r {
            background: rgba(255, 123, 114, 0.12);
            color: var(--sec);
        }

        .chip-k {
            background: rgba(255, 255, 255, 0.06);
            color: var(--muted);
        }

        /* ── HUMAN CHECKPOINTS ── */
        .checkpoints {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 16px;
        }

        .cp-card {
            background: var(--surface2);
            border: 1px solid var(--border2);
            border-radius: 8px;
            padding: 20px 22px;
            position: relative;
            transition: border-color 0.2s;
        }

        .cp-card:hover {
            border-color: rgba(255, 255, 255, 0.2);
        }

        .cp-card.critical {
            border-left: 3px solid var(--sec);
        }

        .cp-card.advisory {
            border-left: 3px solid var(--test);
        }

        .cp-card.review {
            border-left: 3px solid var(--arch);
        }

        .cp-type {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 9px;
            letter-spacing: 2px;
            text-transform: uppercase;
            margin-bottom: 10px;
        }

        .cp-card.critical .cp-type {
            color: var(--sec);
        }

        .cp-card.advisory .cp-type {
            color: var(--test);
        }

        .cp-card.review .cp-type {
            color: var(--arch);
        }

        .cp-card h4 {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 6px;
        }

        .cp-card p {
            font-size: 12px;
            color: var(--muted);
            line-height: 1.6;
            margin-bottom: 10px;
        }

        .cp-trigger {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 10px;
            color: var(--dim);
            background: var(--surface3);
            padding: 6px 10px;
            border-radius: 4px;
            border-left: 2px solid var(--border2);
        }

        /* ── PROMPT TEMPLATES ── */
        .tabs {
            display: flex;
            gap: 1px;
            background: var(--border);
            border-radius: 6px 6px 0 0;
            overflow: hidden;
        }

        .tab {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 11px;
            padding: 10px 18px;
            cursor: pointer;
            color: var(--muted);
            background: var(--surface2);
            border: none;
            outline: none;
            transition: all 0.15s;
            letter-spacing: 0.5px;
            flex: 1;
            text-align: center;
        }

        .tab.active {
            color: var(--text);
            background: var(--surface3);
        }

        .tab:hover:not(.active) {
            color: var(--text);
            background: rgba(255, 255, 255, 0.04);
        }

        .code-panel {
            background: var(--surface2);
            border: 1px solid var(--border2);
            border-top: none;
            border-radius: 0 0 8px 8px;
            padding: 28px;
            display: none;
            position: relative;
        }

        .code-panel.active {
            display: block;
        }

        .code-panel pre {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 12px;
            line-height: 1.8;
            color: #c9d1d9;
            overflow-x: auto;
            white-space: pre;
        }

        .cp-btn {
            position: absolute;
            top: 12px;
            right: 12px;
            font-family: 'IBM Plex Mono', monospace;
            font-size: 10px;
            padding: 4px 12px;
            background: var(--surface3);
            border: 1px solid var(--border2);
            color: var(--muted);
            border-radius: 4px;
            cursor: pointer;
            letter-spacing: 1px;
            transition: all 0.15s;
        }

        .cp-btn:hover {
            color: var(--text);
            border-color: var(--orch);
        }

        /* Syntax */
        .k {
            color: #ff7b72;
        }

        .s {
            color: #a5d6ff;
        }

        .c {
            color: #484f58;
            font-style: italic;
        }

        .n {
            color: #7ee787;
        }

        .v {
            color: #d2a8ff;
        }

        .b {
            color: #79c0ff;
        }

        .y {
            color: #f0e68c;
        }

        .o {
            color: #ffa657;
        }

        /* ── REVIEW GATE ── */
        .review-gate {
            background: rgba(121, 192, 255, 0.04);
            border: 1px dashed rgba(121, 192, 255, 0.35);
            border-radius: 8px;
            padding: 14px 20px;
            margin: 8px auto;
            max-width: 600px;
            text-align: center;
        }

        .review-gate .gate-label {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 9px;
            color: rgba(121, 192, 255, 0.6);
            letter-spacing: 2px;
            text-transform: uppercase;
            margin-bottom: 8px;
        }

        .review-gate .gate-title {
            font-size: 13px;
            font-weight: 600;
            color: var(--arch);
            margin-bottom: 6px;
        }

        .review-gate .gate-rule {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 10px;
            color: var(--muted);
        }

        .review-gate .gate-reviewers {
            display: flex;
            gap: 8px;
            justify-content: center;
            margin-top: 10px;
            flex-wrap: wrap;
        }

        .review-gate .rv {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 10px;
            padding: 3px 10px;
            border-radius: 3px;
            background: var(--surface3);
            border: 1px solid var(--border2);
        }

        .rv.sec {
            color: var(--sec);
            border-color: rgba(255, 123, 114, 0.3);
        }

        .rv.test {
            color: var(--test);
            border-color: rgba(255, 166, 87, 0.3);
        }

        .rv.perf {
            color: var(--arch);
            border-color: rgba(121, 192, 255, 0.3);
        }

        .phase-label {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 9px;
            color: var(--dim);
            letter-spacing: 3px;
            text-transform: uppercase;
            text-align: center;
            margin: 16px 0 6px;
        }

        .parallel-row {
            display: flex;
            gap: 12px;
            justify-content: center;
            flex-wrap: wrap;
            margin: 8px 0;
        }

        .bug-row {
            display: flex;
            gap: 8px;
            justify-content: center;
            flex-wrap: wrap;
            margin: 8px 0;
        }

        .bug-chip {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 10px;
            padding: 4px 12px;
            border-radius: 3px;
        }

        .bug-chip.p0 {
            background: rgba(255, 123, 114, 0.12);
            border: 1px solid rgba(255, 123, 114, 0.35);
            color: var(--sec);
        }

        .bug-chip.p1 {
            background: rgba(255, 166, 87, 0.12);
            border: 1px solid rgba(255, 166, 87, 0.35);
            color: var(--test);
        }

        .bug-chip.p3 {
            background: rgba(126, 231, 135, 0.08);
            border: 1px solid rgba(126, 231, 135, 0.25);
            color: var(--back);
        }

        /* ── RISK TABLE ── */
        .risk-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
            gap: 14px;
        }

        .risk-card {
            background: var(--surface2);
            border: 1px solid var(--border);
            border-radius: 6px;
            padding: 18px;
        }

        .risk-card .severity {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 9px;
            letter-spacing: 2px;
            margin-bottom: 8px;
        }

        .sev-critical {
            color: #ff4d4d;
        }

        .sev-high {
            color: var(--sec);
        }

        .sev-med {
            color: var(--test);
        }

        .sev-low {
            color: var(--back);
        }

        .risk-status {
            display: inline-block;
            font-family: 'IBM Plex Mono', monospace;
            font-size: 9px;
            letter-spacing: 1.5px;
            text-transform: uppercase;
            padding: 2px 8px;
            border-radius: 3px;
            margin-top: 8px;
        }

        .status-built {
            background: rgba(126, 231, 135, 0.1);
            border: 1px solid rgba(126, 231, 135, 0.3);
            color: var(--back);
        }

        .status-planned {
            background: rgba(121, 192, 255, 0.08);
            border: 1px solid rgba(121, 192, 255, 0.25);
            color: var(--arch);
        }

        .risk-card h4 {
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 6px;
        }

        .risk-card p {
            font-size: 12px;
            color: var(--muted);
            line-height: 1.5;
        }

        .risk-card .mitigation {
            font-size: 11px;
            color: var(--arch);
            margin-top: 8px;
            font-family: 'IBM Plex Mono', monospace;
        }

        /* Animations */
        @keyframes rise {
            from {
                opacity: 0;
                transform: translateY(18px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Context window bar */
        .cw-bar {
            height: 4px;
            background: var(--border);
            border-radius: 2px;
            overflow: hidden;
            margin-top: 8px;
        }

        .cw-fill {
            height: 100%;
            border-radius: 2px;
            transition: width 0.3s;
        }

        @media(max-width: 768px) {
            .hdr-top {
                flex-direction: column;
                gap: 16px;
            }

            .hdr-right {
                text-align: left;
            }

            .agent-layer {
                flex-direction: column;
                align-items: center;
            }
        }
    

        /* ── LIGHT MODE OVERRIDES ── */
        [data-theme="light"] {
            --bg: #f6f8fa;
            --surface: #ffffff;
            --surface2: #edf0f4;
            --text: #0d1117;
            --muted: #4b5563;
            --dim: #6b7280;
            --border: rgba(0,0,0,0.10);
            --border2: rgba(0,0,0,0.18);
            /* Darken accents for legibility on white */
            --violet: #6366f1;
            --teal:   #0891b2;
            --gold:   #b45309;
            --rose:   #db2777;
            --green:  #16a34a;
            --red:    #dc2626;
            --amber:  #d97706;
            --blue:   #2563eb;
            --purple: #7c3aed;
        }

        /* Body */
        [data-theme="light"] body {
            background: var(--bg);
            color: var(--text);
        }
        [data-theme="light"] body::before {
            background-image:
                linear-gradient(rgba(0,0,0,0.05) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0,0,0,0.05) 1px, transparent 1px);
        }
        [data-theme="light"] body::after {
            background: none;
        }

        /* ── Code panels always stay dark (standard practice) ── */
        [data-theme="light"] .code-panel,
        [data-theme="light"] pre {
            background: #1e2030 !important;
            color: #cdd6f4 !important;
            border-color: rgba(255,255,255,0.06) !important;
        }
        [data-theme="light"] .cp-btn {
            background: rgba(255,255,255,0.08) !important;
            color: #94a3b8 !important;
        }

        /* ── Navigation / Back button ── */
        [data-theme="light"] .back-btn {
            background: rgba(99,102,241,0.08) !important;
            color: var(--violet) !important;
            border-color: rgba(99,102,241,0.3) !important;
        }
        [data-theme="light"] nav {
            background: rgba(246,248,250,0.95) !important;
            border-bottom-color: var(--border2) !important;
        }
        [data-theme="light"] .nav-logo,
        [data-theme="light"] .nav-breadcrumb { color: var(--text) !important; }

        /* ── Section / Page headers ── */
        [data-theme="light"] .sec-title { color: var(--text) !important; }
        [data-theme="light"] .sec-title span { color: var(--violet) !important; }
        [data-theme="light"] .header h1 { color: var(--text) !important; }
        [data-theme="light"] .tag { color: var(--dim) !important; border-color: var(--border2) !important; }

        /* ── Section containers & cards ── */
        [data-theme="light"] .sec {
            background: var(--surface) !important;
            border-color: var(--border2) !important;
            box-shadow: 0 2px 12px rgba(0,0,0,0.06) !important;
        }
        [data-theme="light"] .card,
        [data-theme="light"] .acard,
        [data-theme="light"] .risk-card,
        [data-theme="light"] .cost-card,
        [data-theme="light"] .arch-wrapper,
        [data-theme="light"] .agents-detail .acard {
            background: var(--surface) !important;
            border-color: var(--border2) !important;
            box-shadow: 0 2px 16px rgba(0,0,0,0.07) !important;
        }
        [data-theme="light"] .acard h3 { color: var(--text) !important; }
        [data-theme="light"] .acard p   { color: var(--muted) !important; }
        [data-theme="light"] .kv-val    { color: var(--muted) !important; }
        [data-theme="light"] .kv-key    { color: var(--dim)   !important; }

        /* ── Tabs ── */
        [data-theme="light"] .tabs {
            background: var(--surface2) !important;
            border-color: var(--border2) !important;
        }
        [data-theme="light"] .tab {
            color: var(--muted) !important;
        }
        [data-theme="light"] .tab:hover {
            color: var(--text) !important;
            background: rgba(0,0,0,0.04) !important;
        }
        [data-theme="light"] .tab.active {
            background: var(--surface) !important;
            color: var(--violet) !important;
            border-color: var(--border2) !important;
        }

        /* ── Hero, stats blocks ── */
        [data-theme="light"] .hero-kicker { color: var(--teal) !important; }
        [data-theme="light"] .hero-desc   { color: var(--muted) !important; }
        [data-theme="light"] .stat-val    { color: var(--text) !important; }
        [data-theme="light"] .stat-label  { color: var(--dim) !important; }

        /* ── Doc cards (index.html) ── */
        [data-theme="light"] .doc-card {
            background: var(--surface) !important;
            border-color: var(--border2) !important;
            box-shadow: 0 4px 20px rgba(0,0,0,0.07) !important;
        }
        [data-theme="light"] .doc-card:hover {
            box-shadow: 0 12px 40px rgba(0,0,0,0.12) !important;
        }
        [data-theme="light"] .card-title  { color: var(--text)  !important; }
        [data-theme="light"] .card-desc   { color: var(--muted) !important; }
        [data-theme="light"] .card-meta   { color: var(--dim)   !important; }
        [data-theme="light"] .pill        { background: rgba(0,0,0,0.06) !important; color: var(--muted) !important; }

        /* ── Agent & flow diagram nodes ── */
        [data-theme="light"] .proc-node,
        [data-theme="light"] .src-node,
        [data-theme="light"] .flow-node,
        [data-theme="light"] .agent-card {
            background: var(--surface) !important;
            border-color: var(--border2) !important;
            color: var(--text) !important;
        }
        [data-theme="light"] .proc-node .title,
        [data-theme="light"] .proc-node .sub { color: var(--text) !important; }
        [data-theme="light"] .proc-node .tech {
            background: rgba(99,102,241,0.12) !important;
            color: var(--violet) !important;
        }
        [data-theme="light"] .output-node {
            background: linear-gradient(135deg, rgba(8,145,178,0.1), rgba(99,102,241,0.1)) !important;
            border-color: rgba(8,145,178,0.4) !important;
        }
        [data-theme="light"] .output-node .badge { color: var(--dim) !important; }
        [data-theme="light"] .output-node .name  { color: var(--text) !important; }
        [data-theme="light"] .output-node .desc  { color: var(--muted) !important; }
        [data-theme="light"] .agent-node .name  { color: var(--text) !important; }
        [data-theme="light"] .agent-node .desc  { color: var(--muted) !important; }
        [data-theme="light"] .agent-node .tool  { background: rgba(0,0,0,0.06) !important; color: var(--muted) !important; }
        [data-theme="light"] .layer-content { border-color: var(--border2) !important; }
        [data-theme="light"] .layer-content::before { background: var(--violet) !important; border-color: var(--bg) !important; }
        [data-theme="light"] .connector-line { border-color: var(--border2) !important; }
        [data-theme="light"] .arch-wrapper { background: var(--surface) !important; border-color: var(--border2) !important; }

        /* ── Tables ── */
        [data-theme="light"] .stack-table th {
            color: var(--dim) !important;
            border-bottom-color: var(--border2) !important;
        }
        [data-theme="light"] .stack-table td {
            color: var(--muted) !important;
            border-bottom-color: var(--border) !important;
        }
        [data-theme="light"] .stack-table td:nth-child(2) { color: var(--text) !important; }
        [data-theme="light"] .stack-table tr:hover td { background: rgba(0,0,0,0.025) !important; }
        [data-theme="light"] .agent-table th { background: var(--surface2) !important; color: var(--dim) !important; border-color: var(--border2) !important; }
        [data-theme="light"] .agent-table td { border-color: var(--border) !important; color: var(--muted) !important; }
        [data-theme="light"] .agent-table tr:hover td { background: rgba(0,0,0,0.02) !important; }

        /* ── Risk cards ── */
        [data-theme="light"] .risk-card {
            background: var(--surface) !important;
            border-color: var(--border2) !important;
        }
        [data-theme="light"] .risk-card h3 { color: var(--text) !important; }
        [data-theme="light"] .risk-card p   { color: var(--muted) !important; }

        /* ── Flow boxes (Agentic workforce) ── */
        [data-theme="light"] .flow-box {
            background: var(--surface) !important;
            border-color: var(--border2) !important;
            color: var(--text) !important;
        }
        [data-theme="light"] .flow-label { color: var(--dim) !important; }

        /* ── Vision block ── */
        [data-theme="light"] .vision {
            background: linear-gradient(135deg, rgba(8,145,178,0.06), rgba(99,102,241,0.06)) !important;
            border-color: rgba(8,145,178,0.25) !important;
        }
        [data-theme="light"] .vision p { color: var(--text) !important; }
        [data-theme="light"] .vtag { color: var(--muted) !important; border-color: var(--border2) !important; }

        /* ── Footer ── */
        [data-theme="light"] .footer {
            border-color: var(--border2) !important;
        }
        [data-theme="light"] .footer-left,
        [data-theme="light"] .footer-right { color: var(--dim) !important; }

        /* ── Doc.html specific (uses different var names) ── */
        [data-theme="light"] .header { border-color: var(--border2) !important; }
        [data-theme="light"] .agent-card {
            background: var(--surface) !important;
            border-color: var(--border2) !important;
            color: var(--text) !important;
        }
        [data-theme="light"] .agent-card .role { color: var(--dim) !important; }
        [data-theme="light"] .agent-card .name { color: var(--text) !important; }
        [data-theme="light"] .agent-card .desc { color: var(--muted) !important; }
        [data-theme="light"] .flow-node { background: var(--surface2) !important; border-color: var(--border2) !important; color: var(--text) !important; }
        [data-theme="light"] .flow-arrow { color: var(--dim) !important; }
        [data-theme="light"] .section-label { color: var(--dim) !important; }

        /* ── "What is an Agent?" section ── */
        [data-theme="light"] .agent-eq { color: var(--muted) !important; }
        [data-theme="light"] .pillar-card {
            background: var(--surface) !important;
            border-color: var(--border2) !important;
        }
        [data-theme="light"] .pillar-card h3  { color: var(--text) !important; }
        [data-theme="light"] .pillar-card p   { color: var(--muted) !important; }
        [data-theme="light"] .pillar-card code { background: rgba(0,0,0,0.06) !important; color: var(--muted) !important; }

        /* ── Pill badges in light mode ── */
        [data-theme="light"] .badge-pill.pill-k { background: rgba(0,0,0,0.07) !important; color: var(--dim) !important; }

        /* ── Scrollbar (WebKit) ── */
        [data-theme="light"] ::-webkit-scrollbar-track { background: var(--surface2) !important; }
        [data-theme="light"] ::-webkit-scrollbar-thumb { background: rgba(0,0,0,0.25) !important; }

        /* ── FLOW DIAGRAM — LIGHT MODE SPECIFIC FIXES ── */
        [data-theme="light"] .orch-box {
            background: rgba(180,83,9,0.05) !important;
            border-color: rgba(180,83,9,0.35) !important;
        }
        [data-theme="light"] .orch-box .label {
            color: #b45309 !important;
        }
        [data-theme="light"] .orch-box .title {
            color: #b45309 !important;
        }
        [data-theme="light"] .orch-box .detail {
            color: #4b5563 !important;
        }

        [data-theme="light"] .human-node {
            background: rgba(99,102,241,0.06) !important;
            border-color: rgba(99,102,241,0.35) !important;
        }
        [data-theme="light"] .human-node .label {
            color: #6b7280 !important;
        }
        [data-theme="light"] .human-node .title {
            color: #0d1117 !important;
        }
        [data-theme="light"] .human-node .detail {
            color: #4b5563 !important;
        }
        [data-theme="light"] .human-node:hover {
            border-color: rgba(99,102,241,0.6) !important;
        }

        [data-theme="light"] .dev-box {
            background: rgba(8,145,178,0.05) !important;
            border-color: rgba(8,145,178,0.3) !important;
        }
        [data-theme="light"] .dev-box .label {
            color: #0891b2 !important;
        }
        [data-theme="light"] .dev-box .title {
            color: #0d1117 !important;
        }
        [data-theme="light"] .dev-box .detail {
            color: #4b5563 !important;
        }

        [data-theme="light"] .rev-box,
        [data-theme="light"] .gate-box {
            background: rgba(220,38,38,0.04) !important;
            border-color: rgba(220,38,38,0.25) !important;
        }
        [data-theme="light"] .rev-box .label,
        [data-theme="light"] .gate-box .label {
            color: #dc2626 !important;
        }
        [data-theme="light"] .rev-box .title,
        [data-theme="light"] .gate-box .title {
            color: #0d1117 !important;
        }
        [data-theme="light"] .rev-box .detail,
        [data-theme="light"] .gate-box .detail {
            color: #4b5563 !important;
        }

        /* Vertical connector lines */
        [data-theme="light"] .vc {
            background: linear-gradient(180deg, rgba(0,0,0,0.2), rgba(0,0,0,0.08)) !important;
        }
        [data-theme="light"] .vc.arrow::after {
            color: #6b7280 !important;
        }
        [data-theme="light"] .vc-label {
            color: #6b7280 !important;
        }
        [data-theme="light"] .phase-label {
            color: #9ca3af !important;
        }

        /* rv (reviewer) badges */
        [data-theme="light"] .rv {
            background: var(--surface2) !important;
            border-color: var(--border2) !important;
            color: var(--text) !important;
        }
        [data-theme="light"] .rv.arch { color: #b45309 !important; border-color: rgba(180,83,9,0.3) !important; }
        [data-theme="light"] .rv.sec  { color: #dc2626 !important; border-color: rgba(220,38,38,0.3) !important; }
        [data-theme="light"] .rv.test { color: #16a34a !important; border-color: rgba(22,163,74,0.3) !important; }
        [data-theme="light"] .rv.perf { color: #2563eb !important; border-color: rgba(37,99,235,0.3) !important; }

        /* Bug chips */
        [data-theme="light"] .bug-chip.p0 { background: rgba(220,38,38,0.08) !important; border-color: rgba(220,38,38,0.3) !important; color: #dc2626 !important; }
        [data-theme="light"] .bug-chip.p1 { background: rgba(217,119,6,0.08) !important; border-color: rgba(217,119,6,0.3) !important;  color: #d97706 !important; }
        [data-theme="light"] .bug-chip.p3 { background: rgba(22,163,74,0.08) !important;  border-color: rgba(22,163,74,0.3) !important;  color: #16a34a !important; }

        /* Inline highlight (was white text) */
        [data-theme="light"] .inline-highlight {
            color: #0d1117;
            font-weight: 600;
        }
        /* Keep dark for dark mode */
        .inline-highlight { color: rgba(255,255,255,0.85); }

        /* cp-card (checkpoint cards) in light mode */
        [data-theme="light"] .cp-card {
            background: var(--surface) !important;
            border-color: var(--border2) !important;
        }
        [data-theme="light"] .cp-card h4 { color: var(--text) !important; }
        [data-theme="light"] .cp-card p  { color: var(--muted) !important; }
        [data-theme="light"] .cp-trigger {
            background: var(--surface2) !important;
            border-left-color: var(--border2) !important;
            color: var(--dim) !important;
        }
        [data-theme="light"] .cp-type { opacity: 0.9 !important; }

        /* Philosophy items */
        [data-theme="light"] .phil-item {
            background: var(--surface) !important;
            border-color: var(--border2) !important;
        }
        [data-theme="light"] .phil-num  { color: var(--dim) !important; }
        [data-theme="light"] .phil-item h3 { color: var(--text) !important; }
        [data-theme="light"] .phil-item p  { color: var(--muted) !important; }

        /* Pipeline label */
        [data-theme="light"] .pipeline-label {
            color: var(--dim) !important;
        }

        /* ═══ COMPREHENSIVE LIGHT MODE FIX — Agentic workforce ═══ */

        /* 1. Vertical connectors & arrows */
        [data-theme="light"] .vc {
            background: linear-gradient(180deg, rgba(0,0,0,0.25), rgba(0,0,0,0.1)) !important;
        }
        [data-theme="light"] .vc.arrow::after {
            color: #4b5563 !important;
        }
        [data-theme="light"] .vc-label {
            color: #6b7280 !important;
            background: var(--bg) !important;
        }
        [data-theme="light"] .phase-label {
            color: #6b7280 !important;
        }

        /* 2. Human node — dashed border fully visible */
        [data-theme="light"] .human-node {
            background: #f0f4ff !important;
            border-color: rgba(99,102,241,0.45) !important;
        }
        [data-theme="light"] .human-node .label   { color: #6366f1 !important; }
        [data-theme="light"] .human-node .title   { color: #0d1117 !important; }
        [data-theme="light"] .human-node .detail  { color: #4b5563 !important; }
        [data-theme="light"] .human-node strong   { color: #0d1117 !important; }
        [data-theme="light"] .inline-highlight    { color: #0d1117 !important; font-weight: 600; }

        /* 3. Orchestrator / reasoning boxes */
        [data-theme="light"] .orch-box {
            background: #fffbeb !important;
            border-color: rgba(180,83,9,0.4) !important;
            box-shadow: none !important;
            animation: none !important;
        }
        [data-theme="light"] .orch-box .label  { color: #92400e !important; }
        [data-theme="light"] .orch-box .title  { color: #92400e !important; }
        [data-theme="light"] .orch-box .detail { color: #374151 !important; }

        /* 4. Dev boxes */
        [data-theme="light"] .dev-box {
            background: #f0fbff !important;
            border-color: rgba(8,145,178,0.4) !important;
        }
        [data-theme="light"] .dev-box .label  { color: #0e7490 !important; }
        [data-theme="light"] .dev-box .title  { color: #0d1117 !important; }
        [data-theme="light"] .dev-box .detail { color: #374151 !important; }

        /* 5. Review / gate boxes */
        [data-theme="light"] .rev-box,
        [data-theme="light"] .gate-box {
            background: #fff5f5 !important;
            border-color: rgba(220,38,38,0.3) !important;
        }
        [data-theme="light"] .rev-box .label,
        [data-theme="light"] .gate-box .label   { color: #b91c1c !important; }
        [data-theme="light"] .rev-box .title,
        [data-theme="light"] .gate-box .title   { color: #0d1117 !important; }
        [data-theme="light"] .rev-box .detail,
        [data-theme="light"] .gate-box .detail  { color: #374151 !important; }

        /* 6. Reviewer badges (rv) */
        [data-theme="light"] .rv {
            background: var(--surface2) !important;
            border-color: var(--border2) !important;
            color: var(--text) !important;
        }
        [data-theme="light"] .rv.arch { color: #92400e !important; border-color: rgba(146,64,14,0.3) !important; }
        [data-theme="light"] .rv.sec  { color: #b91c1c !important; border-color: rgba(185,28,28,0.3) !important; }
        [data-theme="light"] .rv.test { color: #15803d !important; border-color: rgba(21,128,61,0.3) !important; }
        [data-theme="light"] .rv.perf { color: #1d4ed8 !important; border-color: rgba(29,78,216,0.3) !important; }

        /* 7. Checkpoint gate cards */
        [data-theme="light"] .cp-card {
            background: var(--surface) !important;
            border-color: var(--border2) !important;
        }
        [data-theme="light"] .cp-card h4    { color: var(--text) !important; }
        [data-theme="light"] .cp-card p     { color: var(--muted) !important; }
        [data-theme="light"] .cp-card .cp-type { opacity: 1 !important; }
        [data-theme="light"] .cp-card .cp-type.advisory { color: #92400e !important; }
        [data-theme="light"] .cp-trigger {
            background: #f3f4f6 !important;
            color: #374151 !important;
            border-left-color: #d1d5db !important;
        }

        /* 8. Section numbers & headers */
        [data-theme="light"] .sec-title span { color: #6366f1 !important; }
        [data-theme="light"] h2, [data-theme="light"] h3 { color: var(--text) !important; }

        /* 9. Pipeline label (top marquee) */
        [data-theme="light"] .pipeline-label {
            color: #6b7280 !important;
            border-color: rgba(0,0,0,0.1) !important;
        }

        /* 10. Risk register cards */
        [data-theme="light"] .risk-card {
            background: var(--surface) !important;
            border-color: var(--border2) !important;
        }
        [data-theme="light"] .risk-card h3   { color: var(--text) !important; }
        [data-theme="light"] .risk-card p    { color: var(--muted) !important; }
        [data-theme="light"] .risk-meta      { color: var(--dim) !important; }
        [data-theme="light"] .risk-sev.high     { color: #dc2626 !important; background: rgba(220,38,38,0.08) !important; }
        [data-theme="light"] .risk-sev.critical { color: #7c3aed !important; background: rgba(124,58,237,0.08) !important; }
        [data-theme="light"] .risk-sev.medium   { color: #d97706 !important; background: rgba(217,119,6,0.08) !important; }
        [data-theme="light"] .risk-mit { color: #1d4ed8 !important; }

        /* 11. Philosophy items */
        [data-theme="light"] .phil-grid { background: transparent !important; }
        [data-theme="light"] .phil-item {
            background: var(--surface) !important;
            border-color: var(--border2) !important;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06) !important;
        }
        [data-theme="light"] .phil-num      { color: var(--dim) !important; }
        [data-theme="light"] .phil-item h3  { color: var(--text) !important; }
        [data-theme="light"] .phil-item p   { color: var(--muted) !important; }
        [data-theme="light"] .phil-tagline  { color: var(--dim) !important; }

        /* 12. Agent layer cards */
        [data-theme="light"] .al-card {
            background: var(--surface) !important;
            border-color: var(--border2) !important;
        }
        [data-theme="light"] .al-card .al-title { color: var(--text) !important; }
        [data-theme="light"] .al-card .al-role  { color: var(--dim) !important; }
        [data-theme="light"] .al-card .al-desc  { color: var(--muted) !important; }
        [data-theme="light"] .al-card .al-tool  {
            background: rgba(0,0,0,0.06) !important;
            color: var(--muted) !important;
        }

        /* 13. Code panel text already dark — keep correct span colors */
        [data-theme="light"] .code-panel { background: #1e2030 !important; }
        [data-theme="light"] .code-panel pre { color: #cdd6f4 !important; }
        [data-theme="light"] .code-panel .c  { color: #6272a4 !important; }
        [data-theme="light"] .code-panel .k  { color: #ff79c6 !important; }
        [data-theme="light"] .code-panel .n  { color: #f1fa8c !important; }
        [data-theme="light"] .code-panel .s  { color: #f1fa8c !important; }
        [data-theme="light"] .code-panel .v  { color: #8be9fd !important; }
        [data-theme="light"] .code-panel .b  { color: #bd93f9 !important; }

        /* 14. Table in agent roles section */
        [data-theme="light"] .agent-table {
            background: var(--surface) !important;
        }
        [data-theme="light"] .agent-table thead tr {
            background: #f3f4f6 !important;
        }
        [data-theme="light"] .agent-table th {
            color: #374151 !important;
            border-color: #e5e7eb !important;
        }
        [data-theme="light"] .agent-table td {
            color: #4b5563 !important;
            border-color: #e5e7eb !important;
        }
        [data-theme="light"] .agent-table tr:hover td {
            background: rgba(0,0,0,0.02) !important;
        }
        [data-theme="light"] .badge {
            background: rgba(0,0,0,0.07) !important;
            color: #374151 !important;
        }

        /* 15. General catch-all — any remaining rgba(white) text */
        [data-theme="light"] [style*="rgba(255,255,255"] {
            color: #0d1117 !important;
        }

        /* ── THEME TOGGLE BUTTON ── */
        #theme-toggle {
            position: fixed;
            bottom: 28px;
            right: 28px;
            z-index: 9999;
            width: 44px;
            height: 44px;
            border-radius: 50%;
            border: 1px solid var(--border2);
            background: var(--surface);
            color: var(--text);
            font-size: 18px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 20px rgba(0,0,0,0.25);
            transition: transform 0.2s, box-shadow 0.2s;
        }

        #theme-toggle:hover {
            transform: scale(1.1);
            box-shadow: 0 8px 28px rgba(0,0,0,0.3);
        }
    </style>
</head>

<body>
    <a href="index.html" class="back-btn">← Home</a>
    <style>
        .back-btn {
            position: fixed;
            top: 18px;
            right: 24px;
            z-index: 9999;
            background: rgba(100, 220, 160, 0.08);
            color: #7ee786;
            border: 1px solid rgba(100, 220, 160, 0.3);
            padding: 8px 18px;
            border-radius: 6px;
            font-family: 'IBM Plex Mono', monospace;
            font-size: 12px;
            letter-spacing: 1px;
            text-decoration: none;
            backdrop-filter: blur(8px);
            transition: background 0.2s, color 0.2s, border-color 0.2s, transform 0.15s;
        }

        .back-btn:hover {
            background: rgba(100, 220, 160, 0.25);
            color: #fff;
            border-color: rgba(100, 220, 160, 0.7);
            transform: translateY(-2px);
        }
    </style>
    <div class="wrap">

        <!-- Header -->
        <div class="hdr">
            <div class="hdr-top">
                <div>
                    <div class="hdr-badge">AUTONOMOUS BUILD SYSTEM</div>
                    <h1>The <span class="hi">Agent Factory</span><br>That Builds Itself</h1>
                </div>
                <div class="hdr-right">
                    Team B · Feb 22 Demo<br>
                    claude-sonnet-4-6<br>
                    MCP Orchestration<br>
                    Human-in-loop: minimal
                </div>
            </div>
            <p class="hdr-sub">
                An orchestrator coordinates <strong>7 specialized coding agents</strong> to design, build, test, secure,
                and document the
                media intelligence platform — entirely autonomously. Humans are only consulted at
                <strong>critical architectural decisions</strong>, ambiguous requirements, or when agents reach genuine
                impasses.
                Everything else: the agents decide, build, review, and ship.
            </p>
        </div>

        <!-- Philosophy -->
        <div class="sec">
            <div class="sec-title"><span>00</span> — Core Design Philosophy</div>
            <div class="philosophy">
                <h3>// PRINCIPLES GOVERNING THE AGENT FACTORY</h3>
                <div class="phil-grid">
                    <div class="phil-item">
                        <h4>Context is King</h4>
                        <p>Each agent only receives what it needs — no agent sees the full codebase. Orchestrator
                            manages context slicing to stay within windows.</p>
                    </div>
                    <div class="phil-item">
                        <h4>Fail Forward</h4>
                        <p>Agents write code, run tests, see failures, fix them autonomously. Human is never called for
                            a bug fix. Only for decisions that change scope.</p>
                    </div>
                    <div class="phil-item">
                        <h4>Every Commit = Prompt</h4>
                        <p>Each git commit is tagged with the agent that made it + the exact prompt used. Full
                            reproducibility and prompt versioning baked in.</p>
                    </div>
                    <div class="phil-item">
                        <h4>Minimal Human Surface</h4>
                        <p>Human checkpoints: architecture sign-off, security policy, third-party integrations.
                            Everything else is agent-decided and agent-executed.</p>
                    </div>
                    <div class="phil-item">
                        <h4>Agents Review Agents</h4>
                        <p>No agent ships code without a Reviewer Agent signing off. Three specialist reviewers
                            (Security, Test Coverage, Performance) run in parallel at every gate. No human code
                            review needed for iteration.</p>
                    </div>
                    <div class="phil-item">
                        <h4>Prompt Versioning</h4>
                        <p>Every agent system prompt lives in <code>prompts/&lt;agent&gt;.md</code>. Changing a prompt =
                            a PR.
                            Full diff history, rollback capability, and prompt performance tracking built in.</p>
                    </div>
                    <div class="phil-item">
                        <h4>MCP as Standard Transport</h4>
                        <p>All tools are exposed as MCP server endpoints. Any MCP-compatible client — Cursor,
                            Claude Desktop, VSCode — can call the same tool layer the agents use. No vendor
                            lock-in at the tool layer.</p>
                    </div>
                    <div class="phil-item">
                        <h4>Structured Requirement Intake</h4>
                        <p>A Requirements Refiner agent intercepts raw input, clarifies ambiguities, recommends
                            the tech stack, and gets explicit user sign-off before any build work begins.
                            Garbage in is blocked at the gate.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Flow Diagram -->
        <div class="sec">
            <div class="sec-title"><span>01</span> — Full Autonomous Pipeline</div>
            <div class="flow-diagram">
                <div class="flow-label">// 4-PHASE GATED PIPELINE · 14 AGENTS · MCP TOOLS · PARALLEL DEV SPAWNING ·
                    AUTO-COMMIT ON EVERY FILE CHANGE</div>

                <!-- ── PHASE 0: INTAKE ── -->
                <div class="phase-label">PHASE 0 — REQUIREMENT INTAKE</div>

                <div class="human-node" style="max-width:320px;">
                    <div class="label">INITIATOR · INPUT</div>
                    <div class="title">👤 Human</div>
                    <div class="detail" style="margin-top:6px;">
                        uploads <strong class="inline-highlight">React dashboard code file(s)</strong><br>
                        <span style="font-size:9px;letter-spacing:1px;opacity:0.55;">e.g. App.tsx · dashboard.jsx ·
                            components/ · routes.ts</span>
                    </div>
                </div>

                <div class="vc arrow"></div>
                <div class="vc-label">codebase snapshot → Requirements Refiner</div>
                <div class="vc arrow"></div>

                <div class="orch-box" style="border-color:rgba(240,207,101,0.5);">
                    <div class="label">PHASE 0 · REASONING TIER</div>
                    <div class="title" style="color:var(--orch);">🔎 Requirements Refiner</div>
                    <div class="detail">clarifies ambiguity · recommends tech stack · critiques conflicts · waits for
                        user confirmation</div>
                </div>

                <div class="vc arrow"></div>
                <div class="vc-label">RefinedSpec + TechStack confirmed by user</div>
                <div class="vc arrow"></div>

                <div class="orch-box">
                    <div class="label">PLANNING · REASONING TIER</div>
                    <div class="title">🧠 Lead / Project Manager</div>
                    <div class="detail">decomposes into task graph · assigns agents · file-conflict-safe chunking ·
                        manages retries</div>
                </div>

                <!-- ── PHASE 1: ARCHITECTURE ── -->
                <div class="vc arrow"></div>
                <div class="phase-label">PHASE 1 — ARCHITECTURE</div>
                <div class="vc arrow"></div>

                <div class="agent-layer">
                    <div class="ag arch">
                        <div class="ag-icon">📐</div>
                        <div class="ag-name">Architect</div>
                        <div class="ag-role">SystemDesignPlan + TestArchPlan</div>
                    </div>
                </div>

                <div class="vc arrow"></div>
                <div class="vc-label">architecture plan → review gate 1</div>
                <div class="vc arrow"></div>

                <div class="review-gate">
                    <div class="gate-label">🔴 REVIEW GATE 1 — ARCHITECTURE · ALL 3 MUST APPROVE</div>
                    <div class="gate-title">Architecture Review</div>
                    <div class="gate-rule">rejection → back to Architect with consolidated feedback</div>
                    <div class="gate-reviewers">
                        <span class="rv sec">🔒 Security Reviewer</span>
                        <span class="rv test">🧪 Test Coverage Reviewer</span>
                        <span class="rv perf">⚡ Performance Reviewer</span>
                    </div>
                </div>

                <div class="vc arrow"></div>
                <div class="vc-label">all 3 approved → Lead/PM decomposes into task DAG</div>

                <!-- ── PHASE 1.5: LEAD SPAWNING ── -->
                <div class="orch-box" style="max-width:480px;">
                    <div class="label">TASK DECOMPOSITION · LEAD / PM</div>
                    <div class="title">🧠 Lead spawns Developer Agents</div>
                    <div class="detail" style="margin-top:8px;">
                        analyses SystemDesignPlan · classifies every task by domain ·
                        assigns agent type per task · resolves file conflicts via FileLockManager ·
                        dispatches all tracks in <strong style="color:var(--orch);">parallel</strong>
                    </div>
                </div>

                <div class="vc arrow"></div>
                <div class="vc-label">parallel dispatch → 6 specialist developer tracks</div>

                <!-- ── PHASE 2: DEVELOPMENT ── -->
                <div class="phase-label">PHASE 2 — PARALLEL DEVELOPMENT</div>

                <div class="mcp-layer">
                    <div class="mcp-title">📂 FileLockManager — no two agents edit the same file simultaneously</div>
                    <div class="parallel-row" style="gap:10px;margin-top:14px;">
                        <div class="ag front">
                            <div class="ag-icon">🎨</div>
                            <div class="ag-name">Frontend Dev</div>
                            <div class="ag-role">React · UI · routes · state</div>
                        </div>
                        <div class="ag back">
                            <div class="ag-icon">⚙️</div>
                            <div class="ag-name">Backend Dev</div>
                            <div class="ag-role">API · services · auth · middleware</div>
                        </div>
                        <div class="ag arch">
                            <div class="ag-icon">🗄️</div>
                            <div class="ag-name">DB Dev</div>
                            <div class="ag-role">schema · migrations · queries · indexes</div>
                        </div>
                        <div class="ag test">
                            <div class="ag-icon">⏱️</div>
                            <div class="ag-name">Cron / Service Dev</div>
                            <div class="ag-role">background jobs · queues · workers</div>
                        </div>
                        <div class="ag sec">
                            <div class="ag-icon">🚀</div>
                            <div class="ag-name">DevOps Dev</div>
                            <div class="ag-role">Docker · CI/CD · infra · env configs</div>
                        </div>
                        <div class="ag doc">
                            <div class="ag-icon">📝</div>
                            <div class="ag-name">Doc Agent</div>
                            <div class="ag-role">README · docstrings · API docs</div>
                        </div>
                    </div>
                </div>

                <div class="vc arrow"></div>
                <div class="vc-label">code committed → review gate 2</div>
                <div class="vc arrow"></div>

                <div class="review-gate">
                    <div class="gate-label">🟡 REVIEW GATE 2 — CODE · 2 OF 3 MUST APPROVE</div>
                    <div class="gate-title">Code Review</div>
                    <div class="gate-rule">rejection → feedback injected into Developer's next attempt context</div>
                    <div class="gate-reviewers">
                        <span class="rv sec">🔒 Security Reviewer</span>
                        <span class="rv test">🧪 Test Coverage Reviewer</span>
                        <span class="rv perf">⚡ Performance Reviewer</span>
                    </div>
                </div>

                <!-- ── PHASE 3: TESTING + BUGS ── -->
                <div class="vc arrow"></div>
                <div class="phase-label">PHASE 3 — TESTING &amp; BUG TRIAGE</div>
                <div class="vc arrow"></div>

                <div class="agent-layer">
                    <div class="ag test">
                        <div class="ag-icon">🧪</div>
                        <div class="ag-name">Tester</div>
                        <div class="ag-role">runs test framework → BugReport</div>
                    </div>
                </div>

                <div class="vc arrow"></div>
                <div class="vc-label">structured BugReport → Lead assigns severity</div>
                <div class="vc arrow"></div>

                <div class="orch-box" style="max-width:360px;">
                    <div class="label">BUG SEVERITY TRIAGE · LEAD / PM</div>
                    <div class="title">🧠 Lead assigns severity</div>
                    <div class="detail" style="margin-top:10px;">
                        <div class="bug-row">
                            <span class="bug-chip p0">P0 Showstopper</span>
                            <span class="bug-chip p1">P1/P2 Known Bug</span>
                            <span class="bug-chip p3">P3 Low Priority</span>
                        </div>
                    </div>
                </div>

                <div class="vc arrow"></div>
                <div class="vc-label">P0/P1 bugs → Debugger · P3 logged and deferred</div>
                <div class="vc arrow"></div>

                <div class="agent-layer">
                    <div class="ag rev">
                        <div class="ag-icon">🐛</div>
                        <div class="ag-name">Debugger</div>
                        <div class="ag-role">error + git_log + code → fix</div>
                    </div>
                </div>

                <div class="vc arrow"></div>
                <div class="vc-label">fix committed → review gate 3</div>
                <div class="vc arrow"></div>

                <div class="review-gate">
                    <div class="gate-label">🟡 REVIEW GATE 3 — BUG FIX · 2 OF 3 MUST APPROVE</div>
                    <div class="gate-title">Fix Review</div>
                    <div class="gate-rule">approved → Tester re-runs · rejected → back to Debugger</div>
                    <div class="gate-reviewers">
                        <span class="rv sec">🔒 Security Reviewer</span>
                        <span class="rv test">🧪 Test Coverage Reviewer</span>
                        <span class="rv perf">⚡ Performance Reviewer</span>
                    </div>
                </div>

                <div class="vc arrow"></div>
                <div class="vc-label">tools agents call autonomously via MCP</div>
                <div class="vc arrow"></div>

                <!-- MCP Tool Layer -->
                <div class="mcp-layer">
                    <div class="mcp-title">⚡ MCP TOOL LAYER — permission-gated per agent role</div>
                    <div class="mcp-tools">
                        <span class="mcp-tool">write_file</span>
                        <span class="mcp-tool">read_file</span>
                        <span class="mcp-tool">edit_file</span>
                        <span class="mcp-tool">list_files</span>
                        <span class="mcp-tool">execute_code</span>
                        <span class="mcp-tool">run_tests</span>
                        <span class="mcp-tool">shell</span>
                        <span class="mcp-tool">git_commit</span>
                        <span class="mcp-tool">git_log</span>
                        <span class="mcp-tool">git_diff</span>
                        <span class="mcp-tool">search_codebase</span>
                        <span class="mcp-tool">find_files</span>
                        <span class="mcp-tool">ask_human</span>
                    </div>
                </div>

                <div class="vc arrow" style="margin-top:12px;"></div>
                <div class="vc-label">human checkpoint gates (see section 03)</div>
                <div class="vc arrow"></div>

                <div class="human-node" style="border-color:rgba(255,123,114,0.4);">
                    <div class="label" style="color:rgba(255,123,114,0.6);">GATES</div>
                    <div class="title" style="color:var(--sec);">🚦 Human Decision Points</div>
                    <div class="detail">stack confirm · arch sign-off · security policy · credentials · scope changes
                    </div>
                </div>

                <div class="vc arrow"></div>
                <div class="vc-label">approved → agents continue · every file write auto-committed to feature branch
                </div>
                <div class="vc arrow"></div>

                <!-- Output -->
                <div class="output-layer">
                    <div class="out-node">✅ Working Codebase</div>
                    <div class="out-node">📋 Full Test Suite</div>
                    <div class="out-node">📚 Documentation</div>
                    <div class="out-node">🔒 Security Report</div>
                    <div class="out-node">📝 Git Audit Trail</div>
                    <div class="out-node">⚠️ Risk Register</div>
                </div>

            </div>
        </div>

        <!-- Agent Details Table -->
        <div class="sec">
            <div class="sec-title"><span>02</span> — Agent Roles & Responsibilities</div>
            <table class="agent-table">
                <thead>
                    <tr>
                        <th></th>
                        <th>Agent</th>
                        <th>What It Does Autonomously</th>
                        <th>MCP Tools It Uses</th>
                        <th>Context Window Strategy</th>
                        <th>Calls Human When</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>🔎</td>
                        <td style="color:var(--orch);">Requirements Refiner</td>
                        <td>Ingests the uploaded <strong>React dashboard codebase</strong> (files, components, routes).
                            Reads and understands the existing code structure. Asks clarifying questions: what to add,
                            what to change, what constraints apply. Surfaces conflicts between new requirements and
                            existing code patterns. Recommends tech stack additions with rationale. Waits for explicit
                            user confirmation before locking <code>RefinedSpec</code>.</td>
                        <td><span class="chip chip-k">read_file</span> <span class="chip chip-k">search_codebase</span>
                            <span class="chip chip-k">ask_human</span>
                        </td>
                        <td>Sees: uploaded React codebase + new requirements + past RefinedSpec from long-term memory.
                        </td>
                        <td>Always — for stack additions, ambiguities, and conflict resolution with existing code</td>
                    </tr>
                    <tr>
                        <td>🧠</td>
                        <td style="color:var(--orch);">Lead / Project Manager</td>
                        <td>Reads confirmed RefinedSpec. Builds task DAG. Assigns agents. Chunks dev work into
                            file-conflict-safe units (FileLockManager). Assigns bug severity after Tester reports.
                            Re-plans on failures.</td>
                        <td><span class="chip chip-k">list_files</span> <span class="chip chip-k">git_log</span> <span
                                class="chip chip-k">ask_human</span></td>
                        <td>Maintains <code>build_state.json</code>. Never loads full code — only summaries and diffs.
                        </td>
                        <td>Bug severity triage, scope changes, 3+ consecutive agent failures</td>
                    </tr>
                    <tr>
                        <td>📐</td>
                        <td style="color:var(--arch);">Architect</td>
                        <td>Reads confirmed TechStack from RefinedSpec. Designs folder structure, API contracts, DB
                            schema, module boundaries. Writes <code>SystemDesignPlan.md</code> and
                            <code>TestArchitecturePlan.md</code> to shared state before any dev work begins.
                        </td>
                        <td><span class="chip chip-k">read_file</span> <span class="chip chip-k">write_file</span> <span
                                class="chip chip-k">search_codebase</span></td>
                        <td>Only sees: RefinedSpec + existing architecture docs. No implementation code.</td>
                        <td>Conflicting non-functional requirements, third-party API choices not in TechStack</td>
                    </tr>
                    <tr>
                        <td>🔒</td>
                        <td style="color:var(--sec);">Security Reviewer</td>
                        <td>Reviews architecture plans and code diffs for injection risks, exposed secrets, CORS
                            misconfiguration, auth flaws, insecure deps. Runs bandit/safety. <strong>Blocks the
                                review gate</strong> if critical issues found. Returns structured verdict.</td>
                        <td><span class="chip chip-k">read_file</span> <span class="chip chip-k">git_diff</span> <span
                                class="chip chip-k">search_codebase</span></td>
                        <td>Sees: only the diff or plan under review. Never the full codebase.</td>
                        <td>Critical auth flaw or vulnerability with no clear code-level fix</td>
                    </tr>
                    <tr>
                        <td>🧪</td>
                        <td style="color:var(--test);">Test Coverage Reviewer</td>
                        <td>Reviews test coverage <strong>only for the functionality currently being developed</strong>
                            in this review cycle — not the entire codebase. Checks that every acceptance criteria
                            in the current task has a corresponding test, edge cases are covered, and error paths
                            are tested. Returns structured verdict: PASS / GAPS with specific missing tests listed.
                            Does not evaluate unrelated modules.</td>
                        <td><span class="chip chip-k">read_file</span> <span class="chip chip-k">search_codebase</span>
                        </td>
                        <td>Sees: current task's acceptance criteria + diff under review + existing test files for those
                            modules only.</td>
                        <td>Test reveals a spec logic error that requires a requirement change</td>
                    </tr>
                    <tr>
                        <td>⚡</td>
                        <td style="color:var(--front);">Performance Reviewer</td>
                        <td>Reviews architecture and code for N+1 queries, blocking calls in async paths, unbounded
                            memory growth, missing indexes, unscalable patterns. Returns structured verdict with
                            line-level callouts.</td>
                        <td><span class="chip chip-k">read_file</span> <span class="chip chip-k">search_codebase</span>
                        </td>
                        <td>Sees: only the diff or plan. No runtime profiling — static analysis only.</td>
                        <td>Architecture-level perf issue that requires design change</td>
                    </tr>
                    <tr>
                        <td>🎨</td>
                        <td style="color:var(--front);">Frontend Dev</td>
                        <td>Builds React dashboard components, pages, routes, and state management. Reads the uploaded
                            dashboard codebase as its baseline. Implements UI changes per SystemDesignPlan.
                            Runs dev server in sandbox to verify rendering before committing.</td>
                        <td><span class="chip chip-k">read_file</span> <span class="chip chip-k">write_file</span> <span
                                class="chip chip-k">edit_file</span> <span class="chip chip-k">execute_code</span> <span
                                class="chip chip-k">search_codebase</span></td>
                        <td>Sees: input React codebase + SystemDesignPlan UI section + only its assigned component
                            files.</td>
                        <td>Never. Iterates on review feedback autonomously.</td>
                    </tr>
                    <tr>
                        <td>⚙️</td>
                        <td style="color:var(--back);">Backend Dev</td>
                        <td>Implements API routes, services, auth, middleware, and business logic. File-lock aware —
                            only edits files assigned by Lead. Runs server in sandbox, checks logs, fixes errors
                            in a loop until tests pass.</td>
                        <td><span class="chip chip-k">read_file</span> <span class="chip chip-k">write_file</span> <span
                                class="chip chip-k">edit_file</span> <span class="chip chip-k">execute_code</span> <span
                                class="chip chip-k">shell</span> <span class="chip chip-k">search_codebase</span></td>
                        <td>Sees: SystemDesignPlan API section + only its assigned service/route files.</td>
                        <td>Never. Calls ask_human only for genuine spec ambiguity.</td>
                    </tr>
                    <tr>
                        <td>🗄️</td>
                        <td style="color:var(--arch);">DB Dev</td>
                        <td>Designs and implements database schema, migrations, seed data, indexes, and query
                            optimisation. Ensures referential integrity. Runs migrations in sandbox and verifies
                            with query tests before committing.</td>
                        <td><span class="chip chip-k">read_file</span> <span class="chip chip-k">write_file</span> <span
                                class="chip chip-k">edit_file</span> <span class="chip chip-k">execute_code</span> <span
                                class="chip chip-k">shell</span></td>
                        <td>Sees: SystemDesignPlan DB schema section + only its assigned migration/model files.</td>
                        <td>Never. Escalates only if schema conflicts with API contracts.</td>
                    </tr>
                    <tr>
                        <td>⏱️</td>
                        <td style="color:var(--test);">Cron / Service Dev</td>
                        <td>Implements background jobs, task queues, event-driven workers, and scheduled cron tasks.
                            Ensures jobs are idempotent, have retry logic, and dead-letter handling. Tests jobs
                            by triggering them in sandbox.</td>
                        <td><span class="chip chip-k">read_file</span> <span class="chip chip-k">write_file</span> <span
                                class="chip chip-k">edit_file</span> <span class="chip chip-k">execute_code</span> <span
                                class="chip chip-k">shell</span></td>
                        <td>Sees: SystemDesignPlan async/jobs section + only its assigned worker files.</td>
                        <td>Never. Escalates only if a queue dependency is missing from the system design.</td>
                    </tr>
                    <tr>
                        <td>🚀</td>
                        <td style="color:var(--sec);">DevOps Dev</td>
                        <td>Writes Dockerfiles, docker-compose, CI/CD pipeline configs (GitHub Actions / GitLab CI),
                            environment variable templates, and infrastructure-as-code. Validates the build pipeline
                            runs end-to-end in sandbox before committing.</td>
                        <td><span class="chip chip-k">read_file</span> <span class="chip chip-k">write_file</span> <span
                                class="chip chip-k">edit_file</span> <span class="chip chip-k">shell</span> <span
                                class="chip chip-k">execute_code</span></td>
                        <td>Sees: SystemDesignPlan infra section + only its assigned DevOps config files.</td>
                        <td>Never. Escalates only if infra requirements are contradictory or missing.</td>
                    </tr>
                    <tr>
                        <td>📝</td>
                        <td style="color:var(--doc);">Doc Agent</td>
                        <td>Runs in parallel with Developer. Writes README, inline docstrings, OpenAPI docs, setup
                            guide, and <code>AGENTS.md</code> logging every agent's contribution. Triggered after each
                            module is code-complete.</td>
                        <td><span class="chip chip-k">read_file</span> <span class="chip chip-k">write_file</span> <span
                                class="chip chip-k">search_codebase</span></td>
                        <td>Sees: only the module it is documenting. Requests context via search_codebase.</td>
                        <td>Never. Fully autonomous.</td>
                    </tr>
                    <tr>
                        <td>🔬</td>
                        <td style="color:var(--test);">Tester</td>
                        <td>Executes the test framework against all code. Produces a structured <code>BugReport</code>
                            with each bug's error, stack trace, affected files, and reproduction steps. Does not fix
                            bugs — only reports them.</td>
                        <td><span class="chip chip-k">read_file</span> <span class="chip chip-k">execute_code</span>
                            <span class="chip chip-k">run_tests</span>
                        </td>
                        <td>Sees: test suite + the module under test. Test results only.</td>
                        <td>Test reveals a spec logic error that changes requirements</td>
                    </tr>
                    <tr>
                        <td>🐛</td>
                        <td style="color:var(--review);">Debugger</td>
                        <td>Receives BugReport entry + git log for affected files + full file contents. Diagnoses root
                            cause using commit history context. Fixes the bug, verifies in sandbox, commits fix. Fix
                            then goes to Review Gate 3.</td>
                        <td><span class="chip chip-k">read_file</span> <span class="chip chip-k">write_file</span> <span
                                class="chip chip-k">edit_file</span> <span class="chip chip-k">shell</span> <span
                                class="chip chip-k">git_log</span> <span class="chip chip-k">execute_code</span></td>
                        <td>Sees: BugReport entry + git_log for affected files + those files only.</td>
                        <td>Never. Escalates only to Tester for re-verification.</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Human Checkpoints -->
        <div class="sec">
            <div class="sec-title"><span>03</span> — Human Checkpoint Gates</div>
            <div class="checkpoints">
                <div class="cp-card critical">
                    <div class="cp-type">🔴 CRITICAL — MUST ASK</div>
                    <h4>Architecture Sign-Off</h4>
                    <p>Before any code is written, Architect Agent presents the system design: folder structure, DB
                        schema, API surface, tech choices. Human approves or requests changes. This happens once and
                        unlocks the build.</p>
                    <div class="cp-trigger">TRIGGER: Architect finishes ARCHITECTURE.md</div>
                </div>
                <div class="cp-card critical">
                    <div class="cp-type">🔴 CRITICAL — MUST ASK</div>
                    <h4>Security Policy Decision</h4>
                    <p>Security Agent surfaces a policy question: "Should API keys be stored in .env or a secrets
                        manager? Should we add rate limiting?" These are business decisions, not code decisions. Human
                        decides once.</p>
                    <div class="cp-trigger">TRIGGER: Security Agent finds a policy ambiguity</div>
                </div>
                <div class="cp-card critical">
                    <div class="cp-type">🔴 CRITICAL — MUST ASK</div>
                    <h4>Third-Party Credentials</h4>
                    <p>Agents cannot create API keys. When pipeline requires YouTube Data API, Whisper API, or any
                        external service, agents pause and ask human to provide credentials. Then proceed autonomously.
                    </p>
                    <div class="cp-trigger">TRIGGER: Any external API integration point</div>
                </div>
                <div class="cp-card advisory">
                    <div class="cp-type">🟡 ADVISORY — CAN SKIP</div>
                    <h4>Scope Expansion Request</h4>
                    <p>If an agent determines the spec requires a feature not in the original brief (e.g., "real-time
                        websocket support seems necessary"), it raises a scope question rather than silently building
                        it.</p>
                    <div class="cp-trigger">TRIGGER: Agent detects missing requirement</div>
                </div>
                <div class="cp-card advisory">
                    <div class="cp-type">🟡 ADVISORY — CAN SKIP</div>
                    <h4>Cost/Performance Tradeoff</h4>
                    <p>When the Architect faces a genuine tradeoff (e.g., "SQLite is simpler but won't scale; Postgres
                        adds 2 hours of build time") it surfaces the options with a recommendation and waits for human
                        approval.</p>
                    <div class="cp-trigger">TRIGGER: Architect detects design tradeoff</div>
                </div>
                <div class="cp-card review">
                    <div class="cp-type">🔵 REVIEW — END OF PHASE</div>
                    <h4>Phase Completion Review</h4>
                    <p>At the end of each build phase (backend done, frontend done, tests passing), orchestrator
                        presents a summary: what was built, test results, security report, known issues. Human says
                        "continue" or "fix X first."</p>
                    <div class="cp-trigger">TRIGGER: Orchestrator marks phase COMPLETE</div>
                </div>
                <div class="cp-card review">
                    <div class="cp-type">🔵 REVIEW — BEFORE BUILD BEGINS</div>
                    <h4>Tech Stack Confirmation</h4>
                    <p>The Requirements Refiner presents its recommended technology stack (framework, database, infra,
                        testing tools) with rationale for each choice. Human confirms or overrides individual items.
                        <code>RefinedSpec</code> is locked only after explicit confirmation — no assumptions are
                        built in.
                    </p>
                    <div class="cp-trigger">TRIGGER: Requirements Refiner finishes initial analysis</div>
                </div>
                <div class="cp-card advisory">
                    <div class="cp-type">🟡 ADVISORY — OVERRIDE AVAILABLE</div>
                    <h4>Bug Severity Triage</h4>
                    <p>After each Tester run, Lead / PM presents the classified <code>BugReport</code> with its
                        proposed severity assignments (P0 Showstopper / P1-P2 Known / P3 Low Priority). Human can
                        override any severity label before the Debugger is dispatched. Prevents misclassified bugs
                        from blocking or skipping critical fixes.</p>
                    <div class="cp-trigger">TRIGGER: Tester produces a BugReport with 1+ entries</div>
                </div>
            </div>
        </div>

        <!-- Implementation Templates -->
        <div class="sec">
            <div class="sec-title"><span>04</span> — Implementation Templates &amp; Prompts</div>
            <div class="tabs">
                <button class="tab active" onclick="showTab(event,'t-orch')">Orchestrator Prompt</button>
                <button class="tab" onclick="showTab(event,'t-mcp')">MCP Tools Spec</button>
                <button class="tab" onclick="showTab(event,'t-agents')">All Agent Prompts</button>
                <button class="tab" onclick="showTab(event,'t-loop')">Build Loop Doc</button>
                <button class="tab" onclick="showTab(event,'t-state')">State Schema Doc</button>
                <button class="tab" onclick="showTab(event,'t-gitops')">GitOps Policy</button>
                <button class="tab" onclick="showTab(event,'t-prompts')">Prompt Versioning</button>
            </div>

            <!-- ORCHESTRATOR PROMPT -->
            <div class="code-panel active" id="t-orch">
                <button class="cp-btn" onclick="copyTab('t-orch')">COPY PROMPT</button>
                <pre><span class="c">═══════════════════════════════════════════════
  SYSTEM PROMPT — Lead / Project Manager Agent
  Model Tier : REASONING (Claude Opus)
  Temperature: 0.1 — deterministic planning
  File       : prompts/lead_pm.md
═══════════════════════════════════════════════</span>

<span class="n">You are the Lead / Project Manager in a production-grade autonomous build
system. You do NOT write code. You plan, delegate, decompose, track, escalate.</span>

<span class="n">## WHAT YOU DO AT STARTUP
1. Read the confirmed RefinedSpec and SystemDesignPlan.md from the Architect.
2. Decompose all work into a task DAG (Directed Acyclic Graph):
     - task_id, agent_type, input_files, output_files, depends_on[]
     - Tasks that share no files and have no dependency edge = run in PARALLEL
3. Classify every task by agent type:
     FRONTEND_DEV | BACKEND_DEV | DB_DEV | CRON_SERVICE_DEV | DEVOPS_DEV | DOC_AGENT
4. Register all file assignments in FileLockManager before dispatching anyone.
5. Write the full task plan to build_state.json, then dispatch parallel tasks simultaneously.</span>

<span class="n">## DISPATCH RULES
- Dispatch all dependency-free tasks at once (parallel).
- Only dispatch a dependent task after all its dependencies signal COMPLETE.
- After each Tester run: read BugReport, assign severity (P0/P1/P2/P3), update build_state.json.
- On 3 consecutive failures by the same agent: call ask_human with full context.
- Never touch implementation files yourself. You are a coordinator, not a coder.</span>

<span class="n">## HUMAN ESCALATION — ONLY THESE TRIGGERS
- Stack architecture change requested after lock
- A bug is architecture-level (unfixable in code alone)
- 3+ consecutive failures on the same task
- A scope change arrives mid-build
- Security Reviewer raises a CRITICAL requiring design change</span>

<span class="n">## LOGGING FORMAT
  [LEAD] Dispatching FRONTEND_DEV → task: FE-001 — Build Dashboard Header
  [LEAD] Dispatching BACKEND_DEV  → task: BE-007 — Implement /api/ingest
  [LEAD] BugReport received — P0: 1 → dispatching DEBUGGER
  [LEAD] All tasks COMPLETE — triggering final review gate</span></pre>
            </div>

            <!-- MCP TOOLS SPEC -->
            <div class="code-panel" id="t-mcp">
                <button class="cp-btn" onclick="copyTab('t-mcp')">COPY SPEC</button>
                <pre><span class="c">═══════════════════════════════════════════════
  MCP TOOLS SPECIFICATION
  All tools are MCP server endpoints.
  Permission matrix enforced per agent type.
═══════════════════════════════════════════════</span>

<span class="n">── FILE SYSTEM ──────────────────────────────────</span>

<span class="n">read_file(path)
  Purpose : Read any file's contents.
  Returns : Full text content of the file.
  Who     : ALL agents. Primary context-gathering tool.
  Note    : Read only what is needed for the current task.

write_file(path, content, agent, prompt_version)
  Purpose : Write a new file. Triggers auto git-stage + commit via GitOps hook.
  Returns : Confirmation with path written.
  Who     : Developer agents, Doc Agent, Architect.
  Note    : Path guard rejects writes outside /workspace/project.

edit_file(path, old_text, new_text)
  Purpose : Replace a specific block in an existing file (safer than full rewrite).
  Returns : Confirmation with lines changed.
  Who     : Developer agents, Debugger.
  Note    : FileLockManager must have file assigned to calling agent.

list_files(directory)
  Purpose : List all files recursively. Excludes .git, node_modules, __pycache__.
  Returns : JSON array of file paths.
  Who     : Architect, Lead/PM, Reviewer agents.

search_codebase(query, file_pattern)
  Purpose : Semantic + text search across codebase. Prevents hallucinating APIs.
  Returns : List of {file, line, snippet} matches.
  Who     : ALL agents.</span>

<span class="n">── EXECUTION ────────────────────────────────────</span>

<span class="n">execute_code(code, language)
  Purpose : Run a snippet in an isolated Docker sandbox.
  Returns : stdout, stderr, exit code.
  Who     : Developer agents, Debugger, Tester.
  Note    : Sandbox has resource limits. No network. No writes outside /workspace.

shell(command, cwd)
  Purpose : Run shell commands (npm install, pip install, start server, etc).
  Returns : stdout, stderr, exit code.
  Who     : Backend Dev, Frontend Dev, DevOps Dev, Debugger.
  Note    : Never runs destructive commands (rm -rf, drop table, etc).

run_tests(path, framework)
  Purpose : Execute the test suite for a module or full project.
  Returns : Pass/fail counts, coverage %, failed test details.
  Who     : Tester Agent, Reviewer agents (read-only).</span>

<span class="n">── GIT ──────────────────────────────────────────</span>

<span class="n">git_commit(message, agent, prompt_version)
  Purpose : Commit staged files with structured agent metadata.
  Returns : Commit SHA.
  Who     : Developer agents. Called automatically by write_file hook.
  Format  : "[AgentType] description\n\nagent: X\nprompt_version: Y\ntimestamp: Z"

git_diff(staged)
  Purpose : Get current diff (staged or working tree) for review.
  Returns : Full unified diff string.
  Who     : Security, Test Coverage, Performance Reviewer agents. Debugger.

git_log(file, limit)
  Purpose : Show commit history for a file, attributed to agents + prompt versions.
  Returns : List of commits with metadata.
  Who     : Debugger (root cause trace), Lead/PM (audit).</span>

<span class="n">── HUMAN ESCALATION ─────────────────────────────</span>

<span class="n">ask_human(question, context, options)
  Purpose : Block and request human input. USE SPARINGLY.
  Returns : Human typed answer.
  Who     : Lead/PM and Requirements Refiner ONLY.
  RULES   : Call for: stack confirmation, scope changes, credentials, arch sign-off,
            security policy, 3+ failure escalations.
            NEVER for: bugs, code style, implementation choices.
            Every call is logged with the blocking reason.</span></pre>
            </div>

            <!-- ALL AGENT PROMPTS -->
            <div class="code-panel" id="t-agents">
                <button class="cp-btn" onclick="copyTab('t-agents')">COPY PROMPTS</button>
                <pre><span class="c">═══════════════════════════════════════
  PROMPT — Requirements Refiner
  Model: REASONING | Temp: 0.1
  File : prompts/requirements_refiner.md
═══════════════════════════════════════</span>
<span class="n">You receive an uploaded React dashboard codebase. Understand what exists,
then clarify what the human wants to add or change.

STEP 1 — UNDERSTAND THE CODEBASE
Read all uploaded files. Identify:
  - Component structure and naming patterns
  - Routing system (react-router, Next.js pages, etc.)
  - State management (Redux, Zustand, Context, etc.)
  - API integration patterns (axios, fetch, react-query, etc.)
  - Styling system (Tailwind, styled-components, CSS modules, etc.)

STEP 2 — SURFACE AMBIGUITIES (ask only what is needed)
  - What feature or change do you want to add?
  - Performance or accessibility constraints?
  - Must the new code match existing patterns exactly?
  - Any libraries or APIs already integrated to reuse?

STEP 3 — PRODUCE RefinedSpec (only after human confirms)
  - feature_summary       : one-paragraph description
  - acceptance_criteria   : numbered list of testable requirements
  - out_of_scope          : explicit list of things NOT to build
  - tech_stack_additions  : new libraries needed (must be confirmed by human)
  - existing_patterns     : naming, file structure, code style from uploaded code

RULES
  Lock RefinedSpec only after human types: CONFIRMED
  Never assume. If requirements contradict, surface the conflict explicitly.</span>

<span class="c">═══════════════════════════════════════
  PROMPT — Architect Agent
  Model: REASONING | Temp: 0.1
  File : prompts/architect.md
═══════════════════════════════════════</span>
<span class="n">You receive the confirmed RefinedSpec. You design the technical blueprint.
You do NOT write implementation code.

YOU MUST PRODUCE (using write_file for each):
1. SystemDesignPlan.md
   - New folder structure (relative to existing codebase)
   - Module descriptions: what each new file/component does
   - API contracts: endpoint, method, request shape, response shape
   - DB schema changes: tables, columns, indexes, relationships
   - State management additions: stores, slices, selectors

2. TestArchitecturePlan.md
   - For each acceptance criterion: test type (unit/integration/e2e)
   - Which developer agent type writes each test
   - Edge cases to cover per feature
   - Error paths to test explicitly

RULES
  Every interface must be fully defined before any developer agent starts.
  Flag ambiguity via ask_human — do not guess.
  End output with: ARCHITECTURE_COMPLETE</span>

<span class="c">═══════════════════════════════════════
  PROMPT — Frontend Dev Agent
  Model: STANDARD | Temp: 0.2
  File : prompts/frontend_dev.md
═══════════════════════════════════════</span>
<span class="n">You are a Frontend Developer in a file-lock-aware parallel build system.
Build React UI components and routes as specified in SystemDesignPlan.md.
Your baseline is the uploaded React dashboard — match its patterns exactly.

YOUR LOOP
1. Read SystemDesignPlan.md — UI/Frontend section only.
2. Read your assigned files from FileLockManager.
3. Read existing components for style/pattern reference.
4. Implement ONE component or page at a time.
5. After each write: run execute_code to verify no compile/lint errors.
6. Commit each completed file via git_commit.
7. Signal: FRONTEND_TASK_[task_id]_COMPLETE

RULES
  Only edit files in your assigned list. Never touch backend or DB files.
  Match existing naming conventions and folder structure exactly.
  Never install new packages not in confirmed TechStack.
  Never call ask_human — follow the spec or the existing patterns.</span>

<span class="c">═══════════════════════════════════════
  PROMPT — Backend Dev Agent
  Model: STANDARD | Temp: 0.2
  File : prompts/backend_dev.md
═══════════════════════════════════════</span>
<span class="n">You implement server-side API routes, services, and business logic.

YOUR LOOP
1. Read SystemDesignPlan.md — API contracts section.
2. Read your assigned files from FileLockManager.
3. Implement one route/service/module at a time.
4. After each module: run execute_code to verify no startup errors.
5. Fix failures up to 3 attempts with different approaches.
6. Commit each completed module via git_commit.
7. Signal: BACKEND_TASK_[task_id]_COMPLETE

RULES
  Never modify frontend files. Never touch DB migration files.
  On 3rd failure: write failure details to build_state.json and signal FAILED.</span>

<span class="c">═══════════════════════════════════════
  PROMPT — DB Dev Agent
  Model: STANDARD | Temp: 0.2
  File : prompts/db_dev.md
═══════════════════════════════════════</span>
<span class="n">You own all schema and data layer changes.

YOUR LOOP
1. Read SystemDesignPlan.md — DB schema section.
2. Write migration files only (never touch application code).
3. Run migrations in sandbox to verify they apply cleanly.
4. Write seed data if required by acceptance criteria.
5. Verify foreign key integrity and index coverage.
6. Signal: DB_TASK_[task_id]_COMPLETE

RULES
  Never modify API routes or frontend files.
  Every migration must have both up and down (reversible).
  If schema conflicts with API contract: flag in build_state.json, do not guess.</span>

<span class="c">═══════════════════════════════════════
  PROMPT — Security Reviewer
  Model: STANDARD | Temp: 0.1
  File : prompts/security_reviewer.md
═══════════════════════════════════════</span>
<span class="n">You review code diffs and architecture plans for vulnerabilities.
You do NOT fix code. You BLOCK or APPROVE.

CHECKS ON EVERY REVIEW
  - SQL/NoSQL injection risks in query construction
  - Exposed secrets or API keys in code or comments
  - Missing auth/authz on protected routes
  - CORS misconfiguration (overly permissive)
  - Input validation gaps on user-supplied data
  - Sensitive data logged in plaintext

VERDICT FORMAT
  verdict: APPROVED | CHANGES_REQUIRED | BLOCKED
  issues:
    - severity: CRITICAL | HIGH | MEDIUM | LOW
      location: file:line
      description: what the issue is
      recommendation: how to fix it

RULES
  CRITICAL = set REVIEW_GATE_BLOCKED: true. Gate cannot proceed until fixed.
  HIGH = CHANGES_REQUIRED. Developer must fix before next gate attempt.
  MEDIUM/LOW = advisory. Do not block.
  Never fabricate vulnerabilities. Only flag what is visible in the diff.</span>

<span class="c">═══════════════════════════════════════
  PROMPT — Test Coverage Reviewer
  Model: STANDARD | Temp: 0.1
  File : prompts/test_coverage_reviewer.md
═══════════════════════════════════════</span>
<span class="n">You review test coverage ONLY for functionality currently being developed.
You do not review historical coverage or unrelated modules.

YOUR SCOPE (per review cycle)
  - Acceptance criteria of the current task (from build_state.json)
  - The diff of code changes in this review cycle
  - Test files written for those specific changes

CHECKS
For each acceptance criterion in the current task:
  1. Is there a test that directly exercises this criterion?
  2. Is the happy path covered?
  3. Is at least one error/edge case covered?
  4. Are API tests present if the criterion involves an API?

VERDICT FORMAT
  verdict: PASS | GAPS
  gaps:
    - criterion: "User can log in with valid credentials"
      missing: "No test for invalid password (should return 401)"

RULES
  Only evaluate tests for the CURRENT task's acceptance criteria.
  Do not comment on unrelated test files.
  GAPS verdict sends task back to developer with your gap list in their context.</span>

<span class="c">═══════════════════════════════════════
  PROMPT — Debugger Agent
  Model: STANDARD | Temp: 0.1
  File : prompts/debugger.md
═══════════════════════════════════════</span>
<span class="n">You receive one BugReport entry. You find and fix that specific bug only.

YOUR INPUTS (provided in task context)
  - BugReport entry: error message, stack trace, affected files, repro steps
  - git_log for affected files: recent change history
  - Full content of each affected file

YOUR LOOP
1. Read the stack trace. Find the exact line where the error originates.
2. Read git_log for the affected file — see what changed recently.
3. Hypothesize the root cause. Write it out before touching any code.
4. Make the MINIMAL fix. Do not refactor unrelated code.
5. Run execute_code to verify the fix resolves the error.
6. Commit via git_commit. Signal: BUG_[bug_id]_FIXED

RULES
  Fix only ONE bug per task. Log other issues you notice to build_state.json.
  Never call ask_human.
  On 3rd failure: write BUG_[bug_id]_UNRESOLVED with full diagnosis to build_state.json.</span></pre>
            </div>

            <!-- BUILD LOOP DOC -->
            <div class="code-panel" id="t-loop">
                <button class="cp-btn" onclick="copyTab('t-loop')">COPY DOC</button>
                <pre><span class="c">═══════════════════════════════════════════════════
  BUILD LOOP — Execution Model Documentation
  This describes HOW the pipeline runs, phase by phase.
═══════════════════════════════════════════════════</span>

<span class="n">── PHASE 0: INTAKE ────────────────────────────────</span>
<span class="n">TRIGGER : Human uploads React dashboard codebase + describes change
AGENT   : Requirements Refiner
PROCESS :
  1. Agent reads all uploaded files via read_file
  2. Asks clarifying questions via ask_human (blocking)
  3. Human confirms → agent produces RefinedSpec + TechStack
  4. Both written to shared/refined_spec.json
EXITS TO: Phase 1 (Architecture)</span>

<span class="n">── PHASE 1: ARCHITECTURE ──────────────────────────</span>
<span class="n">TRIGGER : RefinedSpec confirmed and locked
AGENT   : Architect (REASONING model)
PROCESS :
  1. Reads RefinedSpec + existing codebase structure
  2. Produces SystemDesignPlan.md (module map, APIs, DB schema)
  3. Produces TestArchitecturePlan.md (test plan per criterion)
  4. Both documents go to Review Gate 1

REVIEW GATE 1 — ALL 3 MUST APPROVE:
  Security Reviewer     → checks architectural security risks
  Test Coverage Reviewer → checks TestArchitecturePlan covers all criteria
  Performance Reviewer  → checks for architectural perf anti-patterns
  Rejection → consolidated feedback → Architect revises → Gate re-runs
  Approval  → Lead/PM proceeds to task decomposition</span>

<span class="n">── PHASE 1.5: TASK DECOMPOSITION ─────────────────</span>
<span class="n">TRIGGER : Review Gate 1 approved
AGENT   : Lead / Project Manager (REASONING model)
PROCESS :
  1. Reads SystemDesignPlan.md in full
  2. Creates task DAG — every task: task_id, agent_type, files_assigned, depends_on[]
  3. Registers all file assignments in FileLockManager
  4. Identifies parallel-safe task groups (no shared files, no dependency edge)
  5. Writes full task plan to build_state.json
  6. Dispatches all dependency-free tasks simultaneously (parallel)</span>

<span class="n">── PHASE 2: PARALLEL DEVELOPMENT ─────────────────</span>
<span class="n">TRIGGER : Lead dispatches tasks
AGENTS  : Frontend Dev, Backend Dev, DB Dev, Cron/Service Dev, DevOps Dev, Doc Agent
PROCESS : All 6 tracks run in parallel, each in its own agentic loop:
  - Agent reads its assigned files and task from build_state.json
  - Agent calls tools freely (read_file, write_file, execute_code, shell)
  - Every write_file → auto-commit via GitOps hook
  - Agent signals COMPLETE when task is done
  - Lead monitors and dispatches dependent tasks as they unlock

REVIEW GATE 2 — 2 OF 3 MUST APPROVE (per module):
  Security Reviewer     → reviews the diff for vulnerabilities
  Test Coverage Reviewer → checks tests for THIS module's acceptance criteria
  Performance Reviewer  → checks for perf anti-patterns
  Rejection → feedback injected into developer context → developer revises</span>

<span class="n">── PHASE 3: TESTING &amp; BUG TRIAGE ─────────────────</span>
<span class="n">TRIGGER : All Phase 2 tasks COMPLETE
AGENTS  : Tester → Lead/PM → Debugger
PROCESS :
  1. Tester runs full test suite via run_tests
  2. Tester produces structured BugReport per bug
  3. Lead/PM assigns severity:
       P0 Showstopper → must fix before release
       P1/P2 Known Bug → fix in this session
       P3 Low Priority → log and defer
  4. Human checkpoint: Lead presents severity assignments, human can override
  5. Debugger receives each P0/P1/P2 bug entry individually, fixes, commits
  6. Tester re-runs → REVIEW GATE 3 (2 of 3 must approve the fix)

BUILD COMPLETE when:
  All tasks COMPLETE, zero P0/P1 open, all Review Gates passed,
  full git audit trail committed for every file change.</span></pre>
            </div>

            <!-- STATE SCHEMA DOC -->
            <div class="code-panel" id="t-state">
                <button class="cp-btn" onclick="copyTab('t-state')">COPY DOC</button>
                <pre><span class="c">═══════════════════════════════════════════════════
  build_state.json — Shared State Schema
  Every agent reads this. Lead/PM writes it.
  Single source of truth for the entire build.
═══════════════════════════════════════════════════</span>

<span class="n">PROJECT BLOCK
  project.name          Short name for the build session
  project.spec_file     Path to confirmed RefinedSpec document
  project.started_at    ISO timestamp of session start
  project.input_files   List of uploaded React dashboard file paths</span>

<span class="n">PHASE TRACKING
  Each phase: PENDING | IN_PROGRESS | COMPLETE | BLOCKED
  Phases: intake, architecture, development, testing, security, docs
  Lead/PM updates each phase in real time as agents signal completion.</span>

<span class="n">TASK DAG — one entry per task
  task_id           Unique ID: FE-001, BE-007, DB-002, CRN-001, etc.
  agent_type        FRONTEND_DEV | BACKEND_DEV | DB_DEV | CRON_DEV | DEVOPS_DEV | DOC_AGENT
  description       One-line description of what the task produces
  assigned_files    Exact list of files this agent is permitted to write
  depends_on        List of task_ids that must be COMPLETE first
  status            PENDING | IN_PROGRESS | COMPLETE | FAILED | BLOCKED
  agent_attempts    How many times agent has attempted (max 3)
  review_gate_status PENDING | APPROVED | CHANGES_REQUIRED | BLOCKED</span>

<span class="n">BUG REPORT — populated by Tester, owned by Lead/PM
  bug_id            Unique ID: BUG-001
  error_message     Exact error from test output
  stack_trace       Full stack trace text
  affected_files    List of files involved
  reproduction_steps Steps to reproduce the bug
  severity          P0 | P1 | P2 | P3  (assigned by Lead/PM)
  status            OPEN | IN_PROGRESS | FIXED | DEFERRED
  assigned_to       DEBUGGER or DEFERRED</span>

<span class="n">HUMAN GATES (any false = pipeline blocked at that phase)
  stack_confirmed           After Requirements Refiner gets tech stack sign-off
  architecture_approved     After human reviews and accepts Architect output
  bug_triage_confirmed      After human reviews Lead's severity assignments
  security_policy_set       After security constraints are confirmed by human</span>

<span class="n">REVIEW GATE FLAGS
  REVIEW_GATE_BLOCKED       Set by any reviewer with CRITICAL finding
                            Cleared only when that finding is resolved &amp; re-approved
  REVIEW_GATE_1_STATUS      Per-reviewer verdict for Architecture Gate
  REVIEW_GATE_2_STATUS      Per-reviewer verdict for Code Gate (per module)
  REVIEW_GATE_3_STATUS      Per-reviewer verdict for Bug Fix Gate</span>

<span class="n">FILE LOCK REGISTRY
  file_locks[].file_path    Relative path to the locked file
  file_locks[].locked_by    agent_type + task_id holding the lock
  file_locks[].locked_at    ISO timestamp of lock acquisition
  Note: No agent may write a file not in its locked list.</span>

<span class="n">METRICS (updated in real time)
  test_coverage             Percentage after each Tester run
  tests_passing             Count of passing tests
  tests_total               Total test count
  files_written             Files created or modified this session
  commits                   Total git commits this session
  security_issues           {critical: N, high: N, medium: N, low: N}</span>

<span class="n">AGENT LOG — append-only audit trail
  agent       Agent name and type
  task_id     Which task this log entry relates to
  action      What the agent did (wrote file, ran test, called tool, etc.)
  timestamp   ISO timestamp
  prompt_version  Which version of the agent's system prompt was active</span></pre>
            </div>

            <!-- GITOPS POLICY -->
            <div class="code-panel" id="t-gitops">
                <button class="cp-btn" onclick="copyTab('t-gitops')">COPY POLICY</button>
                <pre><span class="c">═══════════════════════════════════════════════════
  GITOPS POLICY — Every File Change Becomes a Commit
  System behaviour, not an agent behaviour.
  GitOps hook runs automatically after every write_file or edit_file.
═══════════════════════════════════════════════════</span>

<span class="n">── ON EVERY FILE WRITE ──────────────────────────────</span>
<span class="n">1. Agent calls write_file(path, content, agent_name, prompt_version)
2. GitOps hook intercepts BEFORE returning to the agent
3. Hook stages the file: git add {path}
4. Hook builds a structured commit message:

     [{AgentType}] {one-line description of what was written}

     agent:          {agent_name}
     task_id:        {current task_id from build_state.json}
     prompt_version: {e.g. frontend_dev_v1.3}
     file:           {path}
     timestamp:      {ISO 8601 UTC}

5. Hook commits: git commit -m "{message}"
6. Hook returns commit SHA to agent as confirmation
7. Agent log entry appended to build_state.json</span>

<span class="n">── BRANCH STRATEGY ──────────────────────────────────</span>
<span class="n">Session branch: feature/session-{YYYY-MM-DD}-{session_id}
  Created at session start. All agent commits land on this branch.
  Never commits directly to main.

Merge strategy: Human reviews session branch diff after BUILD_COMPLETE.
  git diff main..feature/session-{id}
  Human merges or cherry-picks as needed.
  Git history = auditable record of every agent action.</span>

<span class="n">── WHAT THE GIT HISTORY GIVES YOU ───────────────────</span>
<span class="n">Full Auditability   : Every file change attributed to exact agent + prompt version
Rollback            : Any file revertable to any agent's prior version via git revert
Prompt Attribution  : Trace which prompt version produced which code
Debugging History   : git_log on any file shows all agent actions for root cause analysis
Reproducibility     : Same prompt version should produce the same commits</span>

<span class="n">── SECURITY RULES FOR COMMITS ───────────────────────</span>
<span class="n">GitOps hook scans the diff for secret patterns before committing:
  (API keys, passwords, tokens, private keys, connection strings)
If secret detected → commit ABORTED → SECURITY_ALERT in build_state.json
Agents must never hardcode credentials — always reference environment variables.

Path Guard:
  write_file and edit_file reject any path resolving outside /workspace/project
  Agents cannot write to: /.git, /etc, /usr, /home outside project, or absolute paths
  Violation → SECURITY_ALERT in build_state.json → agent session terminated</span></pre>
            </div>

            <!-- PROMPT VERSIONING -->
            <div class="code-panel" id="t-prompts">
                <button class="cp-btn" onclick="copyTab('t-prompts')">COPY DOC</button>
                <pre><span class="c">═══════════════════════════════════════════════════
  PROMPT VERSIONING SYSTEM
  Every agent system prompt = a versioned markdown file.
  Changing a prompt = a PR. Full diff history, rollback, attribution.
═══════════════════════════════════════════════════</span>

<span class="n">── PROMPT FILE LOCATIONS ─────────────────────────</span>
<span class="n">  prompts/requirements_refiner.md
  prompts/architect.md
  prompts/lead_pm.md
  prompts/frontend_dev.md
  prompts/backend_dev.md
  prompts/db_dev.md
  prompts/devops_dev.md
  prompts/cron_service_dev.md
  prompts/security_reviewer.md
  prompts/test_coverage_reviewer.md
  prompts/performance_reviewer.md
  prompts/debugger.md
  prompts/tester.md
  prompts/doc_agent.md</span>

<span class="n">── EVERY PROMPT FILE MUST HAVE ───────────────────</span>
<span class="n">FRONTMATTER HEADER (required):
  version:       Semantic version — 1.0, 1.3, 2.1
  agent:         Agent name exactly as in build_state.json
  model_tier:    reasoning | standard | fast
  temperature:   Decimal, e.g. 0.1 or 0.2
  max_tokens:    Token budget for this agent
  tools:         Exact MCP tool names this agent may call
  last_updated:  ISO date
  changed_by:    Human name or "auto" if performance-driven
  change_reason: One sentence explaining why this version was created

BODY SECTIONS (required):
  ## Identity      Who the agent is and what it owns
  ## Inputs        What context the agent receives at task start
  ## Your Loop     Step-by-step process the agent follows
  ## Output Format Exactly what the agent must emit on completion
  ## Rules         Constraints — what it must never do
  ## Escalation    When/how it calls ask_human (most agents: NEVER)</span>

<span class="n">── HOW VERSIONING WORKS ──────────────────────────</span>
<span class="n">Changing a prompt = creating a PR to the prompts/ directory.
Review questions for every prompt change:
  - What behaviour does this change intend to produce?
  - Was old behaviour causing failures? (provide evidence)
  - Has new prompt been tested on 3+ representative tasks?

Version number is embedded in every git commit made by that agent.
You can always trace: "which prompt version produced this code?"</span>

<span class="n">── PERFORMANCE TRACKING ──────────────────────────</span>
<span class="n">Each agent run logs:
  - prompt_version used
  - task success / failure
  - number of tool-call iterations taken
  - tokens consumed
  - review gate verdict received

Over time this shows:
  - Which prompt versions produce the most first-attempt successes
  - Which prompts cause excessive looping (high iteration count)
  - Which prompts produce code that fails review most often

Low-performing versions trigger a prompt improvement cycle:
  Analyse failure pattern → propose edit → PR → test → merge → bump version</span>

<span class="n">── MODEL TIER ASSIGNMENT ─────────────────────────</span>
<span class="n">REASONING (Claude Opus / o1):
  Requirements Refiner, Lead / PM, Architect
  Justification: Their decisions cascade through the entire build.
  Wrong decisions here are expensive. Spend the tokens. Get it right.

STANDARD (Claude Sonnet / GPT-4o):
  Frontend Dev, Backend Dev, DB Dev, Cron Dev, DevOps Dev,
  Security Reviewer, Test Coverage Reviewer, Performance Reviewer, Debugger
  Justification: Focused implementation tasks — smart but not planning-heavy.

FAST (Claude Haiku / GPT-4o-mini):
  Doc Agent, Tester (execution + report structuring only)
  Justification: Template-heavy, pattern-following tasks. Speed and cost matter.</span></pre>
            </div>

        </div>
        <!-- Risk Register -->
        <div class="sec" id="risks">
            <div class="sec-title"><span>05</span> — Agentic AI Risk Register</div>
            <div class="risk-grid">

                <div class="risk-card">
                    <div class="severity sev-critical">⬛ CRITICAL</div>
                    <h4>Error Propagation</h4>
                    <p>A flawed architectural decision or incorrect code module silently infects downstream agents
                        that rely on the same shared state. Errors compound across phases before being caught.</p>
                    <div class="mitigation">→ 3-reviewer parallel gates at every phase boundary. Architecture must
                        achieve 3/3 approval; code and fixes require 2/3. Each gate blocks progression until
                        resolved.</div>
                    <span class="risk-status status-planned">Planned</span>
                </div>

                <div class="risk-card">
                    <div class="severity sev-high">⚠ HIGH</div>
                    <h4>Cost Explosion</h4>
                    <p>Agents in tight retry loops with large context windows consume thousands of tokens per
                        iteration. A single failed P0 bug fix loop can exhaust a session budget.</p>
                    <div class="mitigation">→ Model tiering: Reasoning tier (Opus/o1) only for planning; Standard
                        (Sonnet) for dev/review; Fast (Haiku) for docs/tests. Budget tracker with real-time
                        alerts. P3 bugs deferred — never debugged in-session.</div>
                    <span class="risk-status status-planned">Planned</span>
                </div>

                <div class="risk-card">
                    <div class="severity sev-med">○ MEDIUM</div>
                    <h4>Latency Accumulation</h4>
                    <p>Sequential agent chains with multiple LLM calls per phase create end-to-end latency that
                        makes the system unusable for interactive development loops.</p>
                    <div class="mitigation">→ DAG-based orchestration with parallel branches. Phase 2 runs
                        Developer × N and Doc Agent concurrently. Review Gate uses 3 reviewers in parallel.
                        Fast-tier model for Tester and Doc Agent.</div>
                    <span class="risk-status status-planned">Planned</span>
                </div>

                <div class="risk-card">
                    <div class="severity sev-high">⚠ HIGH</div>
                    <h4>Non-Determinism</h4>
                    <p>High temperature settings cause agents to produce different code or decisions on identical
                        inputs, making bugs unreproducible and reviews inconsistent.</p>
                    <div class="mitigation">→ All agents run at temp=0.2. Pydantic v2 enforces structured output
                        schemas for all agent outputs (RefinedSpec, BugReport, ReviewVerdict). Validation layer
                        rejects malformed outputs before they enter shared state.</div>
                    <span class="risk-status status-built">Built</span>
                </div>

                <div class="risk-card">
                    <div class="severity sev-high">⚠ HIGH</div>
                    <h4>Context Window Exhaustion</h4>
                    <p>Agents that accumulate full conversation history across a long session hit token limits
                        and begin hallucinating or truncating critical context.</p>
                    <div class="mitigation">→ Sliding context window with configurable token budget per agent.
                        Auto-summarization triggers when window approaches limit. Agents never load full codebase
                        — request specific files via read_file tool only.</div>
                    <span class="risk-status status-built">Built</span>
                </div>

                <div class="risk-card">
                    <div class="severity sev-critical">⬛ CRITICAL</div>
                    <h4>Prompt Injection</h4>
                    <p>Malicious content in source files, user input, or tool outputs causes an agent to
                        override its system prompt, exfiltrate data, or execute unintended commands.</p>
                    <div class="mitigation">→ Guardrails layer scans all tool outputs before injecting into
                        agent context. Tool output schema validation rejects unexpected content shapes.
                        Per-agent tool permission matrix — agents can only call their allowed tools.</div>
                    <span class="risk-status status-planned">Planned</span>
                </div>

                <div class="risk-card">
                    <div class="severity sev-critical">⬛ CRITICAL</div>
                    <h4>Tool Misuse / Destructive Actions</h4>
                    <p>An agent calls shell or write_file with a destructive path (e.g., deletes unrelated
                        files, runs <code>rm -rf</code>, or overwrites configuration outside its scope).</p>
                    <div class="mitigation">→ All code execution in Docker sandbox with resource limits. Path
                        guard enforces workspace containment — no writes outside project root. Per-agent
                        permission matrix restricts tool access by role (e.g., Doc Agent cannot call shell).</div>
                    <span class="risk-status status-planned">Planned</span>
                </div>

                <div class="risk-card">
                    <div class="severity sev-high">⚠ HIGH</div>
                    <h4>Identity Explosion / Secret Leak</h4>
                    <p>An agent receives or generates API keys, passwords, or tokens and writes them to a file
                        that gets committed to the git history or logged in plaintext.</p>
                    <div class="mitigation">→ Secrets manager integration — credentials never appear in agent
                        context. GitOps hook scans commit diffs for secret patterns before writing. Agents are
                        explicitly instructed: never generate, store, or transmit credentials.</div>
                    <span class="risk-status status-planned">Planned</span>
                </div>

                <div class="risk-card">
                    <div class="severity sev-high">⚠ HIGH</div>
                    <h4>Observability Gaps</h4>
                    <p>When multi-agent pipelines fail silently or produce wrong output, the absence of
                        structured traces makes root-cause diagnosis nearly impossible.</p>
                    <div class="mitigation">→ OpenTelemetry spans per agent and per tool call. structlog for
                        structured JSON logs. Prometheus metrics for token spend, latency, retry rates. Full
                        git audit trail: every file change committed with agent name + prompt version.</div>
                    <span class="risk-status status-planned">Planned</span>
                </div>

                <div class="risk-card">
                    <div class="severity sev-high">⚠ HIGH</div>
                    <h4>Deadlocks / Infinite Loops</h4>
                    <p>Two agents waiting on each other's output (DAG cycle), or a single agent looping on a
                        fix that continuously fails validation, stalls the entire pipeline indefinitely.</p>
                    <div class="mitigation">→ max_iterations hard cap per agent (default 12). Per-node timeout
                        in the DAG executor. Deadlock detection on graph cycles at build time. On 3+ consecutive
                        failures, Lead auto-escalates to human via ask_human.</div>
                    <span class="risk-status status-built">Built</span>
                </div>

                <div class="risk-card">
                    <div class="severity sev-med">○ MEDIUM</div>
                    <h4>Feedback Loop Poisoning</h4>
                    <p>Incorrect task outcomes (hallucinated successes, false test passes) stored in episodic
                        memory contaminate future agent decisions that draw on past experience.</p>
                    <div class="mitigation">→ Episodic memory entries validated before storage — only outcomes
                        that passed the review gate are recorded. Episode scoring tracks accuracy over time.
                        Poisoned episodes can be flagged and excluded.</div>
                    <span class="risk-status status-built">Built</span>
                </div>

                <div class="risk-card">
                    <div class="severity sev-high">⚠ HIGH</div>
                    <h4>Provider Outage / Rate Limits</h4>
                    <p>Mid-pipeline LLM provider outage or rate limit causes agent failure with no recovery
                        path, losing hours of build progress and requiring manual restart.</p>
                    <div class="mitigation">→ Multi-provider fallback: OpenAI ↔ Anthropic switchover on
                        provider error. Tenacity exponential backoff with jitter on rate limit responses.
                        Build state persisted to disk — pipeline resumes from last completed node, not from
                        scratch.</div>
                    <span class="risk-status status-built">Built</span>
                </div>

            </div>
        </div>

        <!-- Footer -->
        <div
            style="border-top:1px solid var(--border2); margin-top:48px; padding-top:20px; display:flex; justify-content:space-between; align-items:center;">
            <span style="font-family:'IBM Plex Mono',monospace; font-size:11px; color:var(--dim);">SANKHYA · TEAM B ·
                AUTONOMOUS BUILD SYSTEM</span>
            <span style="font-family:'IBM Plex Mono',monospace; font-size:11px; color:var(--dim);">pip install anthropic
                mcp yt-dlp openai-whisper</span>
        </div>

    </div>

    <script>
        function showTab(e, id) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.code-panel').forEach(p => p.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            e.target.classList.add('active');
        }

        function copyTab(id) {
            const pre = document.getElementById(id).querySelector('pre');
            navigator.clipboard.writeText(pre.innerText).then(() => {
                const btn = document.getElementById(id).querySelector('.cp-btn');
                btn.textContent = 'COPIED!';
                btn.style.color = '#7ee787';
                setTimeout(() => { btn.textContent = 'COPY'; btn.style.color = ''; }, 2000);
            });
        }
    </script>

    <!-- Theme Toggle -->
    <button id="theme-toggle" title="Toggle light/dark mode" aria-label="Toggle theme">🌙</button>

    <script>
        (function() {
            var btn = document.getElementById('theme-toggle');
            var stored = localStorage.getItem('theme');
            var prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            var theme = stored || (prefersDark ? 'dark' : 'light');

            function apply(t) {
                document.documentElement.setAttribute('data-theme', t);
                btn.textContent = t === 'dark' ? '☀️' : '🌙';
                localStorage.setItem('theme', t);
            }

            apply(theme);

            btn.addEventListener('click', function() {
                var current = document.documentElement.getAttribute('data-theme');
                apply(current === 'dark' ? 'light' : 'dark');
            });
        })();
    </script>

</body>

</html>