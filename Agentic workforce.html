<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Autonomous Agent Factory ‚Äî Build System Architecture</title>
    <link
        href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;500;600&family=IBM+Plex+Sans:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <style>
        :root {
            --bg: #080c10;
            --surface: #0d1117;
            --surface2: #161b22;
            --surface3: #1c2433;
            --border: #21262d;
            --border2: #30363d;
            --text: #e6edf3;
            --muted: #7d8590;
            --dim: #484f58;

            /* Agent colors */
            --orch: #f0e68c;
            /* gold */
            --arch: #79c0ff;
            /* blue */
            --back: #7ee787;
            /* green */
            --front: #d2a8ff;
            /* purple */
            --test: #ffa657;
            /* orange */
            --sec: #ff7b72;
            /* red */
            --doc: #a5d6ff;
            /* light blue */
            --review: #ffb3d1;
            /* pink */
            --human: #ffffff;
            /* white */
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: var(--bg);
            color: var(--text);
            font-family: 'IBM Plex Sans', sans-serif;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Scanline effect */
        body::before {
            content: '';
            position: fixed;
            inset: 0;
            background: repeating-linear-gradient(0deg,
                    transparent,
                    transparent 2px,
                    rgba(0, 0, 0, 0.03) 2px,
                    rgba(0, 0, 0, 0.03) 4px);
            pointer-events: none;
            z-index: 999;
        }

        .wrap {
            max-width: 1400px;
            margin: 0 auto;
            padding: 48px 32px;
        }

        /* ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ */
        .hdr {
            margin-bottom: 64px;
            animation: rise 0.5s ease;
        }

        .hdr-top {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            border-bottom: 1px solid var(--border2);
            padding-bottom: 24px;
            margin-bottom: 24px;
        }

        .hdr-badge {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 11px;
            color: var(--orch);
            border: 1px solid rgba(240, 230, 140, 0.3);
            padding: 4px 10px;
            margin-bottom: 16px;
            display: inline-block;
            letter-spacing: 2px;
        }

        .hdr h1 {
            font-size: clamp(28px, 4vw, 52px);
            font-weight: 700;
            line-height: 1.05;
            letter-spacing: -0.5px;
        }

        .hdr h1 .hi {
            color: var(--orch);
        }

        .hdr-right {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 11px;
            color: var(--muted);
            line-height: 2;
            text-align: right;
            flex-shrink: 0;
        }

        .hdr-sub {
            font-size: 15px;
            color: var(--muted);
            max-width: 700px;
            line-height: 1.65;
        }

        .hdr-sub strong {
            color: var(--text);
            font-weight: 500;
        }

        /* ‚îÄ‚îÄ SECTION ‚îÄ‚îÄ */
        .sec {
            margin-bottom: 64px;
            animation: rise 0.5s ease both;
        }

        .sec:nth-child(2) {
            animation-delay: 0.05s;
        }

        .sec:nth-child(3) {
            animation-delay: 0.1s;
        }

        .sec:nth-child(4) {
            animation-delay: 0.15s;
        }

        .sec:nth-child(5) {
            animation-delay: 0.2s;
        }

        .sec:nth-child(6) {
            animation-delay: 0.25s;
        }

        .sec-title {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 11px;
            letter-spacing: 3px;
            text-transform: uppercase;
            color: var(--muted);
            margin-bottom: 24px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .sec-title span {
            color: var(--orch);
        }

        .sec-title::after {
            content: '';
            flex: 1;
            height: 1px;
            background: var(--border2);
        }

        /* ‚îÄ‚îÄ PHILOSOPHY BOX ‚îÄ‚îÄ */
        .philosophy {
            background: var(--surface2);
            border: 1px solid var(--border2);
            border-left: 3px solid var(--orch);
            border-radius: 6px;
            padding: 28px 32px;
            margin-bottom: 40px;
        }

        .philosophy h3 {
            font-size: 13px;
            font-weight: 600;
            color: var(--orch);
            letter-spacing: 1px;
            margin-bottom: 16px;
            font-family: 'IBM Plex Mono', monospace;
        }

        .phil-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .phil-item h4 {
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 6px;
        }

        .phil-item p {
            font-size: 12px;
            color: var(--muted);
            line-height: 1.6;
        }

        /* ‚îÄ‚îÄ MAIN FLOW DIAGRAM ‚îÄ‚îÄ */
        .flow-diagram {
            background: var(--surface);
            border: 1px solid var(--border2);
            border-radius: 8px;
            padding: 40px;
            overflow-x: auto;
        }

        .flow-label {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 10px;
            color: var(--dim);
            letter-spacing: 2px;
            text-align: center;
            margin-bottom: 32px;
        }

        /* Big orchestrator */
        .orch-box {
            background: rgba(240, 230, 140, 0.07);
            border: 2px solid rgba(240, 230, 140, 0.4);
            border-radius: 8px;
            padding: 20px 28px;
            text-align: center;
            max-width: 420px;
            margin: 0 auto 8px;
            position: relative;
            animation: pulse-glow 4s ease-in-out infinite;
        }

        @keyframes pulse-glow {

            0%,
            100% {
                box-shadow: 0 0 0 0 rgba(240, 230, 140, 0.15);
            }

            50% {
                box-shadow: 0 0 32px 4px rgba(240, 230, 140, 0.12);
            }
        }

        .orch-box .label {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 10px;
            color: rgba(240, 230, 140, 0.5);
            letter-spacing: 2px;
            margin-bottom: 6px;
        }

        .orch-box .title {
            font-size: 16px;
            font-weight: 600;
            color: var(--orch);
            margin-bottom: 4px;
        }

        .orch-box .detail {
            font-size: 11px;
            color: var(--muted);
            font-family: 'IBM Plex Mono', monospace;
        }

        /* Human checkpoint */
        .human-node {
            background: rgba(255, 255, 255, 0.05);
            border: 2px dashed rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            padding: 14px 20px;
            text-align: center;
            max-width: 200px;
            margin: 0 auto 8px;
            transition: border-color 0.2s;
        }

        .human-node:hover {
            border-color: rgba(255, 255, 255, 0.6);
        }

        .human-node .label {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 9px;
            color: rgba(255, 255, 255, 0.4);
            letter-spacing: 2px;
            margin-bottom: 4px;
        }

        .human-node .title {
            font-size: 13px;
            font-weight: 500;
            color: white;
        }

        .human-node .detail {
            font-size: 10px;
            color: rgba(255, 255, 255, 0.4);
            font-family: 'IBM Plex Mono', monospace;
            margin-top: 3px;
        }

        /* Vertical connector */
        .vc {
            width: 1px;
            height: 28px;
            background: linear-gradient(180deg, var(--border2), rgba(255, 255, 255, 0.15));
            margin: 0 auto;
            position: relative;
        }

        .vc.arrow::after {
            content: '‚ñº';
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 8px;
            color: var(--dim);
        }

        .vc-label {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 9px;
            color: var(--dim);
            text-align: center;
            margin: 2px 0;
            letter-spacing: 1px;
        }

        /* Agent layer */
        .agent-layer {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            justify-content: center;
            margin: 8px 0;
        }

        /* Agent nodes in diagram */
        .ag {
            border: 1px solid;
            border-radius: 6px;
            padding: 12px 16px;
            min-width: 130px;
            text-align: center;
            transition: transform 0.15s, box-shadow 0.15s;
            cursor: default;
        }

        .ag:hover {
            transform: translateY(-3px);
        }

        .ag .ag-icon {
            font-size: 16px;
            margin-bottom: 4px;
        }

        .ag .ag-name {
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 2px;
        }

        .ag .ag-role {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 9px;
            opacity: 0.6;
        }

        .ag.arch {
            border-color: rgba(121, 192, 255, 0.4);
            background: rgba(121, 192, 255, 0.06);
        }

        .ag.back {
            border-color: rgba(126, 231, 135, 0.4);
            background: rgba(126, 231, 135, 0.06);
        }

        .ag.front {
            border-color: rgba(210, 168, 255, 0.4);
            background: rgba(210, 168, 255, 0.06);
        }

        .ag.test {
            border-color: rgba(255, 166, 87, 0.4);
            background: rgba(255, 166, 87, 0.06);
        }

        .ag.sec {
            border-color: rgba(255, 123, 114, 0.4);
            background: rgba(255, 123, 114, 0.06);
        }

        .ag.doc {
            border-color: rgba(165, 214, 255, 0.4);
            background: rgba(165, 214, 255, 0.06);
        }

        .ag.rev {
            border-color: rgba(255, 179, 209, 0.4);
            background: rgba(255, 179, 209, 0.06);
        }

        .ag.arch .ag-name {
            color: var(--arch);
        }

        .ag.back .ag-name {
            color: var(--back);
        }

        .ag.front .ag-name {
            color: var(--front);
        }

        .ag.test .ag-name {
            color: var(--test);
        }

        .ag.sec .ag-name {
            color: var(--sec);
        }

        .ag.doc .ag-name {
            color: var(--doc);
        }

        .ag.rev .ag-name {
            color: var(--review);
        }

        /* MCP tools layer */
        .mcp-layer {
            background: rgba(255, 255, 255, 0.02);
            border: 1px dashed var(--border2);
            border-radius: 8px;
            padding: 16px 20px;
            margin: 8px 0;
        }

        .mcp-title {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 9px;
            color: var(--dim);
            letter-spacing: 2px;
            text-align: center;
            margin-bottom: 12px;
        }

        .mcp-tools {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .mcp-tool {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 10px;
            color: var(--muted);
            background: var(--surface3);
            border: 1px solid var(--border);
            padding: 4px 10px;
            border-radius: 3px;
        }

        /* Output layer */
        .output-layer {
            display: flex;
            gap: 12px;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 8px;
        }

        .out-node {
            background: rgba(126, 231, 135, 0.07);
            border: 1px solid rgba(126, 231, 135, 0.3);
            border-radius: 6px;
            padding: 10px 20px;
            text-align: center;
            font-size: 12px;
            color: var(--back);
            font-weight: 500;
            font-family: 'IBM Plex Mono', monospace;
        }

        /* ‚îÄ‚îÄ AGENT DETAIL TABLE ‚îÄ‚îÄ */
        .agent-table {
            width: 100%;
            border-collapse: collapse;
        }

        .agent-table th {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 10px;
            letter-spacing: 2px;
            text-transform: uppercase;
            color: var(--dim);
            border-bottom: 1px solid var(--border2);
            padding: 10px 16px;
            text-align: left;
        }

        .agent-table td {
            padding: 14px 16px;
            border-bottom: 1px solid var(--border);
            font-size: 13px;
            vertical-align: top;
            line-height: 1.6;
        }

        .agent-table tr:hover td {
            background: rgba(255, 255, 255, 0.02);
        }

        .agent-table td:first-child {
            font-size: 15px;
            width: 40px;
        }

        .agent-table td:nth-child(2) {
            font-weight: 600;
            width: 160px;
        }

        .chip {
            display: inline-block;
            font-family: 'IBM Plex Mono', monospace;
            font-size: 10px;
            padding: 2px 7px;
            border-radius: 3px;
            margin: 2px 2px 2px 0;
        }

        .chip-y {
            background: rgba(240, 230, 140, 0.12);
            color: var(--orch);
        }

        .chip-b {
            background: rgba(121, 192, 255, 0.12);
            color: var(--arch);
        }

        .chip-g {
            background: rgba(126, 231, 135, 0.12);
            color: var(--back);
        }

        .chip-p {
            background: rgba(210, 168, 255, 0.12);
            color: var(--front);
        }

        .chip-o {
            background: rgba(255, 166, 87, 0.12);
            color: var(--test);
        }

        .chip-r {
            background: rgba(255, 123, 114, 0.12);
            color: var(--sec);
        }

        .chip-k {
            background: rgba(255, 255, 255, 0.06);
            color: var(--muted);
        }

        /* ‚îÄ‚îÄ HUMAN CHECKPOINTS ‚îÄ‚îÄ */
        .checkpoints {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 16px;
        }

        .cp-card {
            background: var(--surface2);
            border: 1px solid var(--border2);
            border-radius: 8px;
            padding: 20px 22px;
            position: relative;
            transition: border-color 0.2s;
        }

        .cp-card:hover {
            border-color: rgba(255, 255, 255, 0.2);
        }

        .cp-card.critical {
            border-left: 3px solid var(--sec);
        }

        .cp-card.advisory {
            border-left: 3px solid var(--test);
        }

        .cp-card.review {
            border-left: 3px solid var(--arch);
        }

        .cp-type {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 9px;
            letter-spacing: 2px;
            text-transform: uppercase;
            margin-bottom: 10px;
        }

        .cp-card.critical .cp-type {
            color: var(--sec);
        }

        .cp-card.advisory .cp-type {
            color: var(--test);
        }

        .cp-card.review .cp-type {
            color: var(--arch);
        }

        .cp-card h4 {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 6px;
        }

        .cp-card p {
            font-size: 12px;
            color: var(--muted);
            line-height: 1.6;
            margin-bottom: 10px;
        }

        .cp-trigger {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 10px;
            color: var(--dim);
            background: var(--surface3);
            padding: 6px 10px;
            border-radius: 4px;
            border-left: 2px solid var(--border2);
        }

        /* ‚îÄ‚îÄ PROMPT TEMPLATES ‚îÄ‚îÄ */
        .tabs {
            display: flex;
            gap: 1px;
            background: var(--border);
            border-radius: 6px 6px 0 0;
            overflow: hidden;
        }

        .tab {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 11px;
            padding: 10px 18px;
            cursor: pointer;
            color: var(--muted);
            background: var(--surface2);
            border: none;
            outline: none;
            transition: all 0.15s;
            letter-spacing: 0.5px;
            flex: 1;
            text-align: center;
        }

        .tab.active {
            color: var(--text);
            background: var(--surface3);
        }

        .tab:hover:not(.active) {
            color: var(--text);
            background: rgba(255, 255, 255, 0.04);
        }

        .code-panel {
            background: var(--surface2);
            border: 1px solid var(--border2);
            border-top: none;
            border-radius: 0 0 8px 8px;
            padding: 28px;
            display: none;
            position: relative;
        }

        .code-panel.active {
            display: block;
        }

        .code-panel pre {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 12px;
            line-height: 1.8;
            color: #c9d1d9;
            overflow-x: auto;
            white-space: pre;
        }

        .cp-btn {
            position: absolute;
            top: 12px;
            right: 12px;
            font-family: 'IBM Plex Mono', monospace;
            font-size: 10px;
            padding: 4px 12px;
            background: var(--surface3);
            border: 1px solid var(--border2);
            color: var(--muted);
            border-radius: 4px;
            cursor: pointer;
            letter-spacing: 1px;
            transition: all 0.15s;
        }

        .cp-btn:hover {
            color: var(--text);
            border-color: var(--orch);
        }

        /* Syntax */
        .k {
            color: #ff7b72;
        }

        .s {
            color: #a5d6ff;
        }

        .c {
            color: #484f58;
            font-style: italic;
        }

        .n {
            color: #7ee787;
        }

        .v {
            color: #d2a8ff;
        }

        .b {
            color: #79c0ff;
        }

        .y {
            color: #f0e68c;
        }

        .o {
            color: #ffa657;
        }

        /* ‚îÄ‚îÄ REVIEW GATE ‚îÄ‚îÄ */
        .review-gate {
            background: rgba(121, 192, 255, 0.04);
            border: 1px dashed rgba(121, 192, 255, 0.35);
            border-radius: 8px;
            padding: 14px 20px;
            margin: 8px auto;
            max-width: 600px;
            text-align: center;
        }

        .review-gate .gate-label {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 9px;
            color: rgba(121, 192, 255, 0.6);
            letter-spacing: 2px;
            text-transform: uppercase;
            margin-bottom: 8px;
        }

        .review-gate .gate-title {
            font-size: 13px;
            font-weight: 600;
            color: var(--arch);
            margin-bottom: 6px;
        }

        .review-gate .gate-rule {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 10px;
            color: var(--muted);
        }

        .review-gate .gate-reviewers {
            display: flex;
            gap: 8px;
            justify-content: center;
            margin-top: 10px;
            flex-wrap: wrap;
        }

        .review-gate .rv {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 10px;
            padding: 3px 10px;
            border-radius: 3px;
            background: var(--surface3);
            border: 1px solid var(--border2);
        }

        .rv.sec {
            color: var(--sec);
            border-color: rgba(255, 123, 114, 0.3);
        }

        .rv.test {
            color: var(--test);
            border-color: rgba(255, 166, 87, 0.3);
        }

        .rv.perf {
            color: var(--arch);
            border-color: rgba(121, 192, 255, 0.3);
        }

        .phase-label {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 9px;
            color: var(--dim);
            letter-spacing: 3px;
            text-transform: uppercase;
            text-align: center;
            margin: 16px 0 6px;
        }

        .parallel-row {
            display: flex;
            gap: 12px;
            justify-content: center;
            flex-wrap: wrap;
            margin: 8px 0;
        }

        .bug-row {
            display: flex;
            gap: 8px;
            justify-content: center;
            flex-wrap: wrap;
            margin: 8px 0;
        }

        .bug-chip {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 10px;
            padding: 4px 12px;
            border-radius: 3px;
        }

        .bug-chip.p0 {
            background: rgba(255, 123, 114, 0.12);
            border: 1px solid rgba(255, 123, 114, 0.35);
            color: var(--sec);
        }

        .bug-chip.p1 {
            background: rgba(255, 166, 87, 0.12);
            border: 1px solid rgba(255, 166, 87, 0.35);
            color: var(--test);
        }

        .bug-chip.p3 {
            background: rgba(126, 231, 135, 0.08);
            border: 1px solid rgba(126, 231, 135, 0.25);
            color: var(--back);
        }

        /* ‚îÄ‚îÄ RISK TABLE ‚îÄ‚îÄ */
        .risk-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
            gap: 14px;
        }

        .risk-card {
            background: var(--surface2);
            border: 1px solid var(--border);
            border-radius: 6px;
            padding: 18px;
        }

        .risk-card .severity {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 9px;
            letter-spacing: 2px;
            margin-bottom: 8px;
        }

        .sev-critical {
            color: #ff4d4d;
        }

        .sev-high {
            color: var(--sec);
        }

        .sev-med {
            color: var(--test);
        }

        .sev-low {
            color: var(--back);
        }

        .risk-status {
            display: inline-block;
            font-family: 'IBM Plex Mono', monospace;
            font-size: 9px;
            letter-spacing: 1.5px;
            text-transform: uppercase;
            padding: 2px 8px;
            border-radius: 3px;
            margin-top: 8px;
        }

        .status-built {
            background: rgba(126, 231, 135, 0.1);
            border: 1px solid rgba(126, 231, 135, 0.3);
            color: var(--back);
        }

        .status-planned {
            background: rgba(121, 192, 255, 0.08);
            border: 1px solid rgba(121, 192, 255, 0.25);
            color: var(--arch);
        }

        .risk-card h4 {
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 6px;
        }

        .risk-card p {
            font-size: 12px;
            color: var(--muted);
            line-height: 1.5;
        }

        .risk-card .mitigation {
            font-size: 11px;
            color: var(--arch);
            margin-top: 8px;
            font-family: 'IBM Plex Mono', monospace;
        }

        /* Animations */
        @keyframes rise {
            from {
                opacity: 0;
                transform: translateY(18px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Context window bar */
        .cw-bar {
            height: 4px;
            background: var(--border);
            border-radius: 2px;
            overflow: hidden;
            margin-top: 8px;
        }

        .cw-fill {
            height: 100%;
            border-radius: 2px;
            transition: width 0.3s;
        }

        @media(max-width: 768px) {
            .hdr-top {
                flex-direction: column;
                gap: 16px;
            }

            .hdr-right {
                text-align: left;
            }

            .agent-layer {
                flex-direction: column;
                align-items: center;
            }
        }

        /* ‚îÄ‚îÄ BACK NAV ‚îÄ‚îÄ */
        .back-nav {
            position: sticky;
            top: 0;
            z-index: 100;
            background: rgba(8, 12, 16, 0.92);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border-bottom: 1px solid var(--border2);
            padding: 12px 32px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 16px;
        }

        .back-nav-left {
            display: flex;
            align-items: center;
            gap: 10px;
            font-family: 'IBM Plex Mono', monospace;
            font-size: 11px;
            color: var(--muted);
            letter-spacing: 0.5px;
        }

        .back-link {
            display: flex;
            align-items: center;
            gap: 6px;
            color: var(--orch);
            text-decoration: none;
            font-family: 'IBM Plex Mono', monospace;
            font-size: 11px;
            letter-spacing: 1px;
            padding: 5px 12px;
            border: 1px solid rgba(240, 230, 140, 0.25);
            border-radius: 5px;
            background: rgba(240, 230, 140, 0.05);
            transition: all 0.2s;
        }

        .back-link:hover {
            background: rgba(240, 230, 140, 0.1);
            border-color: rgba(240, 230, 140, 0.5);
        }
    </style>
</head>

<body>
    <nav class="back-nav">
        <div class="back-nav-left">
            <span>AI_ORCH / DOCS</span>
            <span style="color:var(--dim)">/</span>
            <span>Autonomous Agent Factory</span>
        </div>
        <a href="index.html" class="back-link">‚Üê Back to Hub</a>
    </nav>
    <div class="wrap">

        <!-- Header -->
        <div class="hdr">
            <div class="hdr-top">
                <div>
                    <div class="hdr-badge">AUTONOMOUS BUILD SYSTEM</div>
                    <h1>The <span class="hi">Agent Factory</span><br>That Builds Itself</h1>
                </div>
                <div class="hdr-right">
                    Team B ¬∑ Feb 22 Demo<br>
                    claude-sonnet-4-6<br>
                    MCP Orchestration<br>
                    Human-in-loop: minimal
                </div>
            </div>
            <p class="hdr-sub">
                An orchestrator coordinates <strong>7 specialized coding agents</strong> to design, build, test, secure,
                and document the
                media intelligence platform ‚Äî entirely autonomously. Humans are only consulted at
                <strong>critical architectural decisions</strong>, ambiguous requirements, or when agents reach genuine
                impasses.
                Everything else: the agents decide, build, review, and ship.
            </p>
        </div>

        <!-- Philosophy -->
        <div class="sec">
            <div class="sec-title"><span>00</span> ‚Äî Core Design Philosophy</div>
            <div class="philosophy">
                <h3>// PRINCIPLES GOVERNING THE AGENT FACTORY</h3>
                <div class="phil-grid">
                    <div class="phil-item">
                        <h4>Context is King</h4>
                        <p>Each agent only receives what it needs ‚Äî no agent sees the full codebase. Orchestrator
                            manages context slicing to stay within windows.</p>
                    </div>
                    <div class="phil-item">
                        <h4>Fail Forward</h4>
                        <p>Agents write code, run tests, see failures, fix them autonomously. Human is never called for
                            a bug fix. Only for decisions that change scope.</p>
                    </div>
                    <div class="phil-item">
                        <h4>Every Commit = Prompt</h4>
                        <p>Each git commit is tagged with the agent that made it + the exact prompt used. Full
                            reproducibility and prompt versioning baked in.</p>
                    </div>
                    <div class="phil-item">
                        <h4>Minimal Human Surface</h4>
                        <p>Human checkpoints: architecture sign-off, security policy, third-party integrations.
                            Everything else is agent-decided and agent-executed.</p>
                    </div>
                    <div class="phil-item">
                        <h4>Agents Review Agents</h4>
                        <p>No agent ships code without a Reviewer Agent signing off. Three specialist reviewers
                            (Security, Test Coverage, Performance) run in parallel at every gate. No human code
                            review needed for iteration.</p>
                    </div>
                    <div class="phil-item">
                        <h4>Prompt Versioning</h4>
                        <p>Every agent system prompt lives in <code>prompts/&lt;agent&gt;.md</code>. Changing a prompt =
                            a PR.
                            Full diff history, rollback capability, and prompt performance tracking built in.</p>
                    </div>
                    <div class="phil-item">
                        <h4>MCP as Standard Transport</h4>
                        <p>All tools are exposed as MCP server endpoints. Any MCP-compatible client ‚Äî Cursor,
                            Claude Desktop, VSCode ‚Äî can call the same tool layer the agents use. No vendor
                            lock-in at the tool layer.</p>
                    </div>
                    <div class="phil-item">
                        <h4>Structured Requirement Intake</h4>
                        <p>A Requirements Refiner agent intercepts raw input, clarifies ambiguities, recommends
                            the tech stack, and gets explicit user sign-off before any build work begins.
                            Garbage in is blocked at the gate.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Flow Diagram -->
        <div class="sec">
            <div class="sec-title"><span>01</span> ‚Äî Full Autonomous Pipeline</div>
            <div class="flow-diagram">
                <div class="flow-label">// 4-PHASE GATED PIPELINE ¬∑ 10 AGENTS ¬∑ MCP TOOLS ¬∑ AUTO-COMMIT ON EVERY FILE
                    CHANGE</div>

                <!-- ‚îÄ‚îÄ PHASE 0: INTAKE ‚îÄ‚îÄ -->
                <div class="phase-label">PHASE 0 ‚Äî REQUIREMENT INTAKE</div>

                <div class="human-node">
                    <div class="label">INITIATOR</div>
                    <div class="title">üë§ Human</div>
                    <div class="detail">types raw project goal</div>
                </div>

                <div class="vc arrow"></div>
                <div class="vc-label">raw requirement</div>
                <div class="vc arrow"></div>

                <div class="orch-box" style="border-color:rgba(240,207,101,0.5);">
                    <div class="label">PHASE 0 ¬∑ REASONING TIER</div>
                    <div class="title" style="color:var(--orch);">üîé Requirements Refiner</div>
                    <div class="detail">clarifies ambiguity ¬∑ recommends tech stack ¬∑ critiques conflicts ¬∑ waits for
                        user confirmation</div>
                </div>

                <div class="vc arrow"></div>
                <div class="vc-label">RefinedSpec + TechStack confirmed by user</div>
                <div class="vc arrow"></div>

                <div class="orch-box">
                    <div class="label">PLANNING ¬∑ REASONING TIER</div>
                    <div class="title">üß† Lead / Project Manager</div>
                    <div class="detail">decomposes into task graph ¬∑ assigns agents ¬∑ file-conflict-safe chunking ¬∑
                        manages retries</div>
                </div>

                <!-- ‚îÄ‚îÄ PHASE 1: ARCHITECTURE ‚îÄ‚îÄ -->
                <div class="vc arrow"></div>
                <div class="phase-label">PHASE 1 ‚Äî ARCHITECTURE</div>
                <div class="vc arrow"></div>

                <div class="agent-layer">
                    <div class="ag arch">
                        <div class="ag-icon">üìê</div>
                        <div class="ag-name">Architect</div>
                        <div class="ag-role">SystemDesignPlan + TestArchPlan</div>
                    </div>
                </div>

                <div class="vc arrow"></div>
                <div class="vc-label">architecture plan ‚Üí review gate 1</div>
                <div class="vc arrow"></div>

                <div class="review-gate">
                    <div class="gate-label">üî¥ REVIEW GATE 1 ‚Äî ARCHITECTURE ¬∑ ALL 3 MUST APPROVE</div>
                    <div class="gate-title">Architecture Review</div>
                    <div class="gate-rule">rejection ‚Üí back to Architect with consolidated feedback</div>
                    <div class="gate-reviewers">
                        <span class="rv sec">üîí Security Reviewer</span>
                        <span class="rv test">üß™ Test Coverage Reviewer</span>
                        <span class="rv perf">‚ö° Performance Reviewer</span>
                    </div>
                </div>

                <div class="vc arrow"></div>
                <div class="vc-label">all 3 approved ‚Üí FileLockManager assigns files</div>

                <!-- ‚îÄ‚îÄ PHASE 2: DEVELOPMENT ‚îÄ‚îÄ -->
                <div class="phase-label">PHASE 2 ‚Äî PARALLEL DEVELOPMENT</div>

                <div class="mcp-layer">
                    <div class="mcp-title">üìÇ FileLockManager ‚Äî no two agents touch the same file</div>
                    <div class="parallel-row">
                        <div class="ag back">
                            <div class="ag-icon">‚öôÔ∏è</div>
                            <div class="ag-name">Developer √ó N</div>
                            <div class="ag-role">file-lock aware ¬∑ iterates on feedback</div>
                        </div>
                        <div class="ag doc">
                            <div class="ag-icon">üìù</div>
                            <div class="ag-name">Doc Agent</div>
                            <div class="ag-role">README ¬∑ docstrings ¬∑ API docs</div>
                        </div>
                    </div>
                </div>

                <div class="vc arrow"></div>
                <div class="vc-label">code committed ‚Üí review gate 2</div>
                <div class="vc arrow"></div>

                <div class="review-gate">
                    <div class="gate-label">üü° REVIEW GATE 2 ‚Äî CODE ¬∑ 2 OF 3 MUST APPROVE</div>
                    <div class="gate-title">Code Review</div>
                    <div class="gate-rule">rejection ‚Üí feedback injected into Developer's next attempt context</div>
                    <div class="gate-reviewers">
                        <span class="rv sec">üîí Security Reviewer</span>
                        <span class="rv test">üß™ Test Coverage Reviewer</span>
                        <span class="rv perf">‚ö° Performance Reviewer</span>
                    </div>
                </div>

                <!-- ‚îÄ‚îÄ PHASE 3: TESTING + BUGS ‚îÄ‚îÄ -->
                <div class="vc arrow"></div>
                <div class="phase-label">PHASE 3 ‚Äî TESTING &amp; BUG TRIAGE</div>
                <div class="vc arrow"></div>

                <div class="agent-layer">
                    <div class="ag test">
                        <div class="ag-icon">üß™</div>
                        <div class="ag-name">Tester</div>
                        <div class="ag-role">runs test framework ‚Üí BugReport</div>
                    </div>
                </div>

                <div class="vc arrow"></div>
                <div class="vc-label">structured BugReport ‚Üí Lead assigns severity</div>
                <div class="vc arrow"></div>

                <div class="orch-box" style="max-width:360px;">
                    <div class="label">BUG SEVERITY TRIAGE ¬∑ LEAD / PM</div>
                    <div class="title">üß† Lead assigns severity</div>
                    <div class="detail" style="margin-top:10px;">
                        <div class="bug-row">
                            <span class="bug-chip p0">P0 Showstopper</span>
                            <span class="bug-chip p1">P1/P2 Known Bug</span>
                            <span class="bug-chip p3">P3 Low Priority</span>
                        </div>
                    </div>
                </div>

                <div class="vc arrow"></div>
                <div class="vc-label">P0/P1 bugs ‚Üí Debugger ¬∑ P3 logged and deferred</div>
                <div class="vc arrow"></div>

                <div class="agent-layer">
                    <div class="ag rev">
                        <div class="ag-icon">üêõ</div>
                        <div class="ag-name">Debugger</div>
                        <div class="ag-role">error + git_log + code ‚Üí fix</div>
                    </div>
                </div>

                <div class="vc arrow"></div>
                <div class="vc-label">fix committed ‚Üí review gate 3</div>
                <div class="vc arrow"></div>

                <div class="review-gate">
                    <div class="gate-label">üü° REVIEW GATE 3 ‚Äî BUG FIX ¬∑ 2 OF 3 MUST APPROVE</div>
                    <div class="gate-title">Fix Review</div>
                    <div class="gate-rule">approved ‚Üí Tester re-runs ¬∑ rejected ‚Üí back to Debugger</div>
                    <div class="gate-reviewers">
                        <span class="rv sec">üîí Security Reviewer</span>
                        <span class="rv test">üß™ Test Coverage Reviewer</span>
                        <span class="rv perf">‚ö° Performance Reviewer</span>
                    </div>
                </div>

                <div class="vc arrow"></div>
                <div class="vc-label">tools agents call autonomously via MCP</div>
                <div class="vc arrow"></div>

                <!-- MCP Tool Layer -->
                <div class="mcp-layer">
                    <div class="mcp-title">‚ö° MCP TOOL LAYER ‚Äî permission-gated per agent role</div>
                    <div class="mcp-tools">
                        <span class="mcp-tool">write_file</span>
                        <span class="mcp-tool">read_file</span>
                        <span class="mcp-tool">edit_file</span>
                        <span class="mcp-tool">list_files</span>
                        <span class="mcp-tool">execute_code</span>
                        <span class="mcp-tool">run_tests</span>
                        <span class="mcp-tool">shell</span>
                        <span class="mcp-tool">git_commit</span>
                        <span class="mcp-tool">git_log</span>
                        <span class="mcp-tool">git_diff</span>
                        <span class="mcp-tool">search_codebase</span>
                        <span class="mcp-tool">find_files</span>
                        <span class="mcp-tool">ask_human</span>
                    </div>
                </div>

                <div class="vc arrow" style="margin-top:12px;"></div>
                <div class="vc-label">human checkpoint gates (see section 03)</div>
                <div class="vc arrow"></div>

                <div class="human-node" style="border-color:rgba(255,123,114,0.4);">
                    <div class="label" style="color:rgba(255,123,114,0.6);">GATES</div>
                    <div class="title" style="color:var(--sec);">üö¶ Human Decision Points</div>
                    <div class="detail">stack confirm ¬∑ arch sign-off ¬∑ security policy ¬∑ credentials ¬∑ scope changes
                    </div>
                </div>

                <div class="vc arrow"></div>
                <div class="vc-label">approved ‚Üí agents continue ¬∑ every file write auto-committed to feature branch
                </div>
                <div class="vc arrow"></div>

                <!-- Output -->
                <div class="output-layer">
                    <div class="out-node">‚úÖ Working Codebase</div>
                    <div class="out-node">üìã Full Test Suite</div>
                    <div class="out-node">üìö Documentation</div>
                    <div class="out-node">üîí Security Report</div>
                    <div class="out-node">üìù Git Audit Trail</div>
                    <div class="out-node">‚ö†Ô∏è Risk Register</div>
                </div>

            </div>
        </div>

        <!-- Agent Details Table -->
        <div class="sec">
            <div class="sec-title"><span>02</span> ‚Äî Agent Roles & Responsibilities</div>
            <table class="agent-table">
                <thead>
                    <tr>
                        <th></th>
                        <th>Agent</th>
                        <th>What It Does Autonomously</th>
                        <th>MCP Tools It Uses</th>
                        <th>Context Window Strategy</th>
                        <th>Calls Human When</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>üîé</td>
                        <td style="color:var(--orch);">Requirements Refiner</td>
                        <td>Intercepts raw user input. Asks clarifying questions if vague. Surfaces conflicts.
                            Recommends tech stack with rationale. Waits for explicit user confirmation before locking
                            <code>RefinedSpec</code>. Critiques contradictions with past decisions.
                        </td>
                        <td><span class="chip chip-k">ask_human</span></td>
                        <td>Only sees: raw user input + past RefinedSpec from long-term memory.</td>
                        <td>Always ‚Äî for stack confirmation, ambiguities, and conflict resolution</td>
                    </tr>
                    <tr>
                        <td>üß†</td>
                        <td style="color:var(--orch);">Lead / Project Manager</td>
                        <td>Reads confirmed RefinedSpec. Builds task DAG. Assigns agents. Chunks dev work into
                            file-conflict-safe units (FileLockManager). Assigns bug severity after Tester reports.
                            Re-plans on failures.</td>
                        <td><span class="chip chip-k">list_files</span> <span class="chip chip-k">git_log</span> <span
                                class="chip chip-k">ask_human</span></td>
                        <td>Maintains <code>build_state.json</code>. Never loads full code ‚Äî only summaries and diffs.
                        </td>
                        <td>Bug severity triage, scope changes, 3+ consecutive agent failures</td>
                    </tr>
                    <tr>
                        <td>üìê</td>
                        <td style="color:var(--arch);">Architect</td>
                        <td>Reads confirmed TechStack from RefinedSpec. Designs folder structure, API contracts, DB
                            schema, module boundaries. Writes <code>SystemDesignPlan.md</code> and
                            <code>TestArchitecturePlan.md</code> to shared state before any dev work begins.
                        </td>
                        <td><span class="chip chip-k">read_file</span> <span class="chip chip-k">write_file</span> <span
                                class="chip chip-k">search_codebase</span></td>
                        <td>Only sees: RefinedSpec + existing architecture docs. No implementation code.</td>
                        <td>Conflicting non-functional requirements, third-party API choices not in TechStack</td>
                    </tr>
                    <tr>
                        <td>üîí</td>
                        <td style="color:var(--sec);">Security Reviewer</td>
                        <td>Reviews architecture plans and code diffs for injection risks, exposed secrets, CORS
                            misconfiguration, auth flaws, insecure deps. Runs bandit/safety. <strong>Blocks the
                                review gate</strong> if critical issues found. Returns structured verdict.</td>
                        <td><span class="chip chip-k">read_file</span> <span class="chip chip-k">git_diff</span> <span
                                class="chip chip-k">search_codebase</span></td>
                        <td>Sees: only the diff or plan under review. Never the full codebase.</td>
                        <td>Critical auth flaw or vulnerability with no clear code-level fix</td>
                    </tr>
                    <tr>
                        <td>üß™</td>
                        <td style="color:var(--test);">Test Coverage Reviewer</td>
                        <td>Reviews test plans and code for coverage gaps, missing edge cases, untested error paths,
                            missing integration tests. Checks that test architecture aligns with the system design.
                            Returns structured verdict with specific gaps.</td>
                        <td><span class="chip chip-k">read_file</span> <span class="chip chip-k">search_codebase</span>
                        </td>
                        <td>Sees: TestArchitecturePlan + diff under review. Nothing else.</td>
                        <td>Test reveals a spec logic error that requires requirement change</td>
                    </tr>
                    <tr>
                        <td>‚ö°</td>
                        <td style="color:var(--front);">Performance Reviewer</td>
                        <td>Reviews architecture and code for N+1 queries, blocking calls in async paths, unbounded
                            memory growth, missing indexes, unscalable patterns. Returns structured verdict with
                            line-level callouts.</td>
                        <td><span class="chip chip-k">read_file</span> <span class="chip chip-k">search_codebase</span>
                        </td>
                        <td>Sees: only the diff or plan. No runtime profiling ‚Äî static analysis only.</td>
                        <td>Architecture-level perf issue that requires design change</td>
                    </tr>
                    <tr>
                        <td>‚öôÔ∏è</td>
                        <td style="color:var(--back);">Developer</td>
                        <td>Implements code per SystemDesignPlan. File-lock aware ‚Äî only edits files assigned by Lead.
                            Iterates on review feedback (feedback injected into context). Runs code in sandbox to
                            verify before committing.</td>
                        <td><span class="chip chip-k">read_file</span> <span class="chip chip-k">write_file</span> <span
                                class="chip chip-k">edit_file</span> <span class="chip chip-k">execute_code</span> <span
                                class="chip chip-k">shell</span> <span class="chip chip-k">search_codebase</span></td>
                        <td>Sees: SystemDesignPlan + only files assigned to it by FileLockManager.</td>
                        <td>Never. Fixes its own bugs. Calls ask_human only for genuine spec ambiguity.</td>
                    </tr>
                    <tr>
                        <td>üìù</td>
                        <td style="color:var(--doc);">Doc Agent</td>
                        <td>Runs in parallel with Developer. Writes README, inline docstrings, OpenAPI docs, setup
                            guide, and <code>AGENTS.md</code> logging every agent's contribution. Triggered after each
                            module is code-complete.</td>
                        <td><span class="chip chip-k">read_file</span> <span class="chip chip-k">write_file</span> <span
                                class="chip chip-k">search_codebase</span></td>
                        <td>Sees: only the module it is documenting. Requests context via search_codebase.</td>
                        <td>Never. Fully autonomous.</td>
                    </tr>
                    <tr>
                        <td>üî¨</td>
                        <td style="color:var(--test);">Tester</td>
                        <td>Executes the test framework against all code. Produces a structured <code>BugReport</code>
                            with each bug's error, stack trace, affected files, and reproduction steps. Does not fix
                            bugs ‚Äî only reports them.</td>
                        <td><span class="chip chip-k">read_file</span> <span class="chip chip-k">execute_code</span>
                            <span class="chip chip-k">run_tests</span>
                        </td>
                        <td>Sees: test suite + the module under test. Test results only.</td>
                        <td>Test reveals a spec logic error that changes requirements</td>
                    </tr>
                    <tr>
                        <td>üêõ</td>
                        <td style="color:var(--review);">Debugger</td>
                        <td>Receives BugReport entry + git log for affected files + full file contents. Diagnoses root
                            cause using commit history context. Fixes the bug, verifies in sandbox, commits fix. Fix
                            then goes to Review Gate 3.</td>
                        <td><span class="chip chip-k">read_file</span> <span class="chip chip-k">write_file</span> <span
                                class="chip chip-k">edit_file</span> <span class="chip chip-k">shell</span> <span
                                class="chip chip-k">git_log</span> <span class="chip chip-k">execute_code</span></td>
                        <td>Sees: BugReport entry + git_log for affected files + those files only.</td>
                        <td>Never. Escalates only to Tester for re-verification.</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Human Checkpoints -->
        <div class="sec">
            <div class="sec-title"><span>03</span> ‚Äî Human Checkpoint Gates</div>
            <div class="checkpoints">
                <div class="cp-card critical">
                    <div class="cp-type">üî¥ CRITICAL ‚Äî MUST ASK</div>
                    <h4>Architecture Sign-Off</h4>
                    <p>Before any code is written, Architect Agent presents the system design: folder structure, DB
                        schema, API surface, tech choices. Human approves or requests changes. This happens once and
                        unlocks the build.</p>
                    <div class="cp-trigger">TRIGGER: Architect finishes ARCHITECTURE.md</div>
                </div>
                <div class="cp-card critical">
                    <div class="cp-type">üî¥ CRITICAL ‚Äî MUST ASK</div>
                    <h4>Security Policy Decision</h4>
                    <p>Security Agent surfaces a policy question: "Should API keys be stored in .env or a secrets
                        manager? Should we add rate limiting?" These are business decisions, not code decisions. Human
                        decides once.</p>
                    <div class="cp-trigger">TRIGGER: Security Agent finds a policy ambiguity</div>
                </div>
                <div class="cp-card critical">
                    <div class="cp-type">üî¥ CRITICAL ‚Äî MUST ASK</div>
                    <h4>Third-Party Credentials</h4>
                    <p>Agents cannot create API keys. When pipeline requires YouTube Data API, Whisper API, or any
                        external service, agents pause and ask human to provide credentials. Then proceed autonomously.
                    </p>
                    <div class="cp-trigger">TRIGGER: Any external API integration point</div>
                </div>
                <div class="cp-card advisory">
                    <div class="cp-type">üü° ADVISORY ‚Äî CAN SKIP</div>
                    <h4>Scope Expansion Request</h4>
                    <p>If an agent determines the spec requires a feature not in the original brief (e.g., "real-time
                        websocket support seems necessary"), it raises a scope question rather than silently building
                        it.</p>
                    <div class="cp-trigger">TRIGGER: Agent detects missing requirement</div>
                </div>
                <div class="cp-card advisory">
                    <div class="cp-type">üü° ADVISORY ‚Äî CAN SKIP</div>
                    <h4>Cost/Performance Tradeoff</h4>
                    <p>When the Architect faces a genuine tradeoff (e.g., "SQLite is simpler but won't scale; Postgres
                        adds 2 hours of build time") it surfaces the options with a recommendation and waits for human
                        approval.</p>
                    <div class="cp-trigger">TRIGGER: Architect detects design tradeoff</div>
                </div>
                <div class="cp-card review">
                    <div class="cp-type">üîµ REVIEW ‚Äî END OF PHASE</div>
                    <h4>Phase Completion Review</h4>
                    <p>At the end of each build phase (backend done, frontend done, tests passing), orchestrator
                        presents a summary: what was built, test results, security report, known issues. Human says
                        "continue" or "fix X first."</p>
                    <div class="cp-trigger">TRIGGER: Orchestrator marks phase COMPLETE</div>
                </div>
                <div class="cp-card review">
                    <div class="cp-type">üîµ REVIEW ‚Äî BEFORE BUILD BEGINS</div>
                    <h4>Tech Stack Confirmation</h4>
                    <p>The Requirements Refiner presents its recommended technology stack (framework, database, infra,
                        testing tools) with rationale for each choice. Human confirms or overrides individual items.
                        <code>RefinedSpec</code> is locked only after explicit confirmation ‚Äî no assumptions are
                        built in.
                    </p>
                    <div class="cp-trigger">TRIGGER: Requirements Refiner finishes initial analysis</div>
                </div>
                <div class="cp-card advisory">
                    <div class="cp-type">üü° ADVISORY ‚Äî OVERRIDE AVAILABLE</div>
                    <h4>Bug Severity Triage</h4>
                    <p>After each Tester run, Lead / PM presents the classified <code>BugReport</code> with its
                        proposed severity assignments (P0 Showstopper / P1-P2 Known / P3 Low Priority). Human can
                        override any severity label before the Debugger is dispatched. Prevents misclassified bugs
                        from blocking or skipping critical fixes.</p>
                    <div class="cp-trigger">TRIGGER: Tester produces a BugReport with 1+ entries</div>
                </div>
            </div>
        </div>

        <!-- Code Templates -->
        <div class="sec">
            <div class="sec-title"><span>04</span> ‚Äî Implementation Templates</div>
            <div class="tabs">
                <button class="tab active" onclick="showTab(event,'t-orch')">Orchestrator</button>
                <button class="tab" onclick="showTab(event,'t-mcp')">MCP Tools</button>
                <button class="tab" onclick="showTab(event,'t-agents')">Agent Prompts</button>
                <button class="tab" onclick="showTab(event,'t-loop')">Build Loop</button>
                <button class="tab" onclick="showTab(event,'t-state')">State Schema</button>
                <button class="tab" onclick="showTab(event,'t-gitops')">GitOps Hook</button>
                <button class="tab" onclick="showTab(event,'t-prompts')">Prompt Versioning</button>
            </div>

            <!-- Orchestrator -->
            <div class="code-panel active" id="t-orch">
                <button class="cp-btn" onclick="copyTab('t-orch')">COPY</button>
                <pre><span class="c"># orchestrator.py ‚Äî the master build controller</span>
<span class="k">import</span> asyncio, json
<span class="k">from</span> mcp <span class="k">import</span> ClientSession, StdioServerParameters
<span class="k">from</span> mcp.client.stdio <span class="k">import</span> stdio_client
<span class="k">import</span> anthropic

<span class="v">client</span> = anthropic.Anthropic()

<span class="n">ORCHESTRATOR_PROMPT</span> = <span class="s">"""
You are a software build orchestrator. You manage a team of AI agents
building a media intelligence platform. You have access to MCP tools.

Your workflow:
1. Read the project spec
2. Call architect_agent to design the system
3. Present architecture to human via ask_human tool ‚Äî WAIT for approval
4. Dispatch backend_agent to build services (it loops until tests pass)
5. Dispatch frontend_agent to build dashboard
6. Dispatch tester_agent to write + run all tests
7. Dispatch security_agent to audit ‚Äî it can BLOCK merges
8. Dispatch documenter_agent for all docs
9. Present phase summary to human for sign-off

Rules:
- Never write code yourself. Only route to agents.
- Only call ask_human for: arch approval, security policy, credentials, scope changes
- Track state in build_state.json at all times
- If an agent fails 3 times, escalate to human with context
- Each completed task = a git commit with agent tag + prompt version
"""</span>

<span class="k">async def</span> <span class="n">run_build</span>(spec: str):
    <span class="v">server</span> = StdioServerParameters(command=<span class="s">"python"</span>, args=[<span class="s">"mcp_tools.py"</span>])

    <span class="k">async with</span> stdio_client(server) <span class="k">as</span> (r, w):
        <span class="k">async with</span> ClientSession(r, w) <span class="k">as</span> session:
            <span class="k">await</span> session.initialize()

            <span class="c"># Get all tools and pass to Claude</span>
            <span class="v">tools</span> = <span class="k">await</span> session.list_tools()
            <span class="v">mcp_tools</span> = [t.dict() <span class="k">for</span> t <span class="k">in</span> tools.tools]

            <span class="v">messages</span> = [{<span class="s">"role"</span>: <span class="s">"user"</span>, <span class="s">"content"</span>: <span class="s">f"Build this: {spec}"</span>}]

            <span class="c"># Agentic loop ‚Äî runs until orchestrator says DONE</span>
            <span class="k">while True</span>:
                <span class="v">resp</span> = client.messages.create(
                    model=<span class="s">"claude-sonnet-4-6"</span>,
                    max_tokens=<span class="b">4096</span>,
                    system=ORCHESTRATOR_PROMPT,
                    tools=mcp_tools,
                    messages=messages
                )

                <span class="c"># Collect text and tool calls</span>
                <span class="k">for</span> block <span class="k">in</span> resp.content:
                    <span class="k">if</span> block.type == <span class="s">"text"</span>:
                        print(<span class="s">f"\nüß† Orchestrator: {block.text}"</span>)
                    <span class="k">elif</span> block.type == <span class="s">"tool_use"</span>:
                        <span class="v">result</span> = <span class="k">await</span> session.call_tool(block.name, block.input)
                        messages.append({<span class="s">"role"</span>: <span class="s">"assistant"</span>, <span class="s">"content"</span>: resp.content})
                        messages.append({
                            <span class="s">"role"</span>: <span class="s">"user"</span>,
                            <span class="s">"content"</span>: [{
                                <span class="s">"type"</span>: <span class="s">"tool_result"</span>,
                                <span class="s">"tool_use_id"</span>: block.id,
                                <span class="s">"content"</span>: str(result.content)
                            }]
                        })

                <span class="k">if</span> resp.stop_reason == <span class="s">"end_turn"</span>:
                    print(<span class="s">"\n‚úÖ Build complete!"</span>)
                    <span class="k">break</span>

<span class="k">if</span> __name__ == <span class="s">"__main__"</span>:
    <span class="v">spec</span> = open(<span class="s">"PROJECT_SPEC.md"</span>).read()
    asyncio.run(run_build(spec))</pre>
            </div>

            <!-- MCP Tools -->
            <div class="code-panel" id="t-mcp">
                <button class="cp-btn" onclick="copyTab('t-mcp')">COPY</button>
                <pre><span class="c"># mcp_tools.py ‚Äî all tools agents can call autonomously</span>
<span class="k">from</span> mcp.server <span class="k">import</span> Server
<span class="k">from</span> mcp.server.stdio <span class="k">import</span> stdio_server
<span class="k">import</span> subprocess, os, json

<span class="v">app</span> = Server(<span class="s">"build-tools"</span>)

<span class="c"># ‚îÄ‚îÄ File System ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ</span>
@app.tool()
<span class="k">async def</span> <span class="n">write_file</span>(path: str, content: str, agent: str, prompt_version: str) -> str:
    <span class="s">"""Write file. Automatically tags the commit with agent + prompt version."""</span>
    os.makedirs(os.path.dirname(path) <span class="k">or</span> <span class="s">"."</span>, exist_ok=<span class="b">True</span>)
    open(path, <span class="s">"w"</span>).write(content)
    <span class="c"># Auto-stage for git</span>
    subprocess.run([<span class="s">"git"</span>, <span class="s">"add"</span>, path], check=<span class="b">True</span>)
    <span class="k">return</span> <span class="s">f"Written: {path}"</span>

@app.tool()
<span class="k">async def</span> <span class="n">read_file</span>(path: str) -> str:
    <span class="s">"""Read file contents."""</span>
    <span class="k">return</span> open(path).read() <span class="k">if</span> os.path.exists(path) <span class="k">else</span> <span class="s">f"FILE_NOT_FOUND: {path}"</span>

@app.tool()
<span class="k">async def</span> <span class="n">list_files</span>(directory: str = <span class="s">"."</span>) -> str:
    <span class="s">"""List files in directory."""</span>
    <span class="v">result</span> = []
    <span class="k">for</span> root, dirs, files <span class="k">in</span> os.walk(directory):
        dirs[:] = [d <span class="k">for</span> d <span class="k">in</span> dirs <span class="k">if</span> d <span class="k">not in</span> [<span class="s">".git"</span>, <span class="s">"node_modules"</span>, <span class="s">"__pycache__"</span>]]
        <span class="k">for</span> f <span class="k">in</span> files:
            result.append(os.path.join(root, f))
    <span class="k">return</span> json.dumps(result)

<span class="c"># ‚îÄ‚îÄ Execution ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ</span>
@app.tool()
<span class="k">async def</span> <span class="n">run_command</span>(cmd: str, cwd: str = <span class="s">"."</span>) -> str:
    <span class="s">"""Run a shell command. Returns stdout + stderr."""</span>
    <span class="v">r</span> = subprocess.run(cmd, shell=<span class="b">True</span>, capture_output=<span class="b">True</span>, text=<span class="b">True</span>, cwd=cwd)
    <span class="k">return</span> <span class="s">f"STDOUT:\n{r.stdout}\nSTDERR:\n{r.stderr}\nEXIT: {r.returncode}"</span>

@app.tool()
<span class="k">async def</span> <span class="n">run_tests</span>(path: str = <span class="s">"."</span>) -> str:
    <span class="s">"""Run pytest and return results."""</span>
    <span class="v">r</span> = subprocess.run(<span class="s">f"pytest {path} -v --tb=short"</span>,
                        shell=<span class="b">True</span>, capture_output=<span class="b">True</span>, text=<span class="b">True</span>)
    <span class="k">return</span> <span class="s">f"{r.stdout}\n{r.stderr}"</span>

<span class="c"># ‚îÄ‚îÄ Git ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ</span>
@app.tool()
<span class="k">async def</span> <span class="n">git_commit</span>(message: str, agent: str, prompt_version: str) -> str:
    <span class="s">"""Commit staged files with agent metadata."""</span>
    full_msg = <span class="s">f"{message}\n\nAgent: {agent}\nPrompt: {prompt_version}"</span>
    subprocess.run([<span class="s">"git"</span>, <span class="s">"commit"</span>, <span class="s">"-m"</span>, full_msg], check=<span class="b">True</span>)
    <span class="k">return</span> <span class="s">"Committed"</span>

@app.tool()
<span class="k">async def</span> <span class="n">git_diff</span>(staged: bool = <span class="b">False</span>) -> str:
    <span class="s">"""Get current git diff for review."""</span>
    <span class="v">cmd</span> = <span class="s">"git diff --staged"</span> <span class="k">if</span> staged <span class="k">else</span> <span class="s">"git diff"</span>
    <span class="v">r</span> = subprocess.run(cmd, shell=<span class="b">True</span>, capture_output=<span class="b">True</span>, text=<span class="b">True</span>)
    <span class="k">return</span> r.stdout

<span class="c"># ‚îÄ‚îÄ Human Escalation ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ</span>
@app.tool()
<span class="k">async def</span> <span class="n">ask_human</span>(question: str, context: str, options: list = <span class="b">None</span>) -> str:
    <span class="s">"""
    Block and ask the human a question. Use SPARINGLY.
    Only for: architecture approval, security policy, credentials, scope changes.
    Never for: bugs, code style, implementation details.
    """</span>
    print(<span class="s">f"\n{'='*60}"</span>)
    print(<span class="s">f"üö¶ HUMAN INPUT REQUIRED"</span>)
    print(<span class="s">f"Context: {context}"</span>)
    print(<span class="s">f"\nQuestion: {question}"</span>)
    <span class="k">if</span> options:
        <span class="k">for</span> i, opt <span class="k">in</span> enumerate(options):
            print(<span class="s">f"  {i+1}. {opt}"</span>)
    <span class="k">return</span> input(<span class="s">"\nYour answer: "</span>)</pre>
            </div>

            <!-- Agent Prompts -->
            <div class="code-panel" id="t-agents">
                <button class="cp-btn" onclick="copyTab('t-agents')">COPY</button>
                <pre><span class="c"># agent_prompts.py ‚Äî system prompts for each specialized agent</span>

<span class="n">ARCHITECT_PROMPT</span> = <span class="s">"""
You are a software Architect agent. You receive a project spec and produce
a complete technical design. Do NOT write implementation code.

You MUST output:
1. ARCHITECTURE.md ‚Äî folder structure, module descriptions
2. api_contract.json ‚Äî all API endpoints, request/response schemas
3. db_schema.sql ‚Äî all tables, indexes, relationships
4. tech_decisions.md ‚Äî stack choices with rationale

Rules:
- Choose the simplest stack that meets requirements
- Every interface must be fully specified before dev agents start
- Flag any ambiguous requirements for human approval
- Use write_file tool for each output file
- End with: ARCHITECTURE_COMPLETE
"""</span>

<span class="n">BACKEND_PROMPT</span> = <span class="s">"""
You are a Backend Developer agent. You implement server-side code ONLY.
You have access to the filesystem and can run commands.

Your loop:
1. Read ARCHITECTURE.md and api_contract.json
2. Implement one module at a time
3. run_command to start server and check for errors
4. run_tests on each module before moving to next
5. Fix any errors you find ‚Äî never give up after first failure
6. git_commit each completed module

Rules:
- Never ask human for help with bugs
- Retry failed implementations up to 3 times with different approaches
- Always check run_tests passes before marking a module done
- Use read_logs to diagnose runtime errors
- End each module with: MODULE_[name]_COMPLETE
"""</span>

<span class="n">FRONTEND_PROMPT</span> = <span class="s">"""
You are a Frontend Developer agent. You build the React dashboard UI.
You have access to the filesystem and can run commands.

Your loop:
1. Read api_contract.json to understand backend interfaces
2. Scaffold React app with correct folder structure
3. Build each component ‚Äî media card, sentiment display, trend chart
4. run_command npm start and check for compile errors
5. Fix errors autonomously
6. Ensure every API endpoint is wired up

Rules:
- Do not build features not in the spec
- Keep components small and composable
- Never ask human about UI decisions ‚Äî use your best judgment
- End with: FRONTEND_COMPLETE
"""</span>

<span class="n">TESTER_PROMPT</span> = <span class="s">"""
You are a Testing agent. You write and run comprehensive tests.

Your loop:
1. Read each module's code
2. Write unit tests for every function
3. Write integration tests for API endpoints
4. run_tests ‚Äî read failures ‚Äî fix tests or report bugs to orchestrator
5. Maintain >80% coverage

Rules:
- If a test reveals a spec violation, report it ‚Äî don't hide it
- Write test names that document behavior, not implementation
- Never skip tests because they're hard to write
- End with: TESTS_COMPLETE ‚Äî coverage: [X]%
"""</span>

<span class="n">SECURITY_PROMPT</span> = <span class="s">"""
You are a Security Auditor agent. You review ALL code before it ships.

Your checks:
- SQL injection / NoSQL injection risks
- Exposed API keys or secrets in code
- Insecure dependencies (run: safety check)
- Missing authentication / authorization
- CORS misconfiguration
- Input validation gaps
- run_command bandit -r . for static analysis

Output: security_report.md with:
- CRITICAL issues (block merge)
- HIGH issues (fix before ship)
- MEDIUM issues (fix in next sprint)
- PASSED checks

Rules:
- CRITICAL issues = set flag MERGE_BLOCKED in build_state.json
- Never approve code with CRITICAL issues
- Escalate to human ONLY if an architectural change is needed to fix a critical
"""</span>

<span class="n">REVIEWER_PROMPT</span> = <span class="s">"""
You are a Code Reviewer agent. You review diffs before any commit lands.

Read the git diff and check for:
- Logic errors that tests might miss
- Naming that obscures intent
- DRY violations (same logic in 2+ places)
- Functions that do more than one thing
- Missing error handling

Return either:
APPROVED ‚Äî with brief summary
CHANGES_REQUESTED ‚Äî with specific line-by-line feedback

Rules:
- Be precise, not pedantic
- Do not block for style issues ‚Äî only correctness and clarity
- Never ask human ‚Äî the dev agent will fix and resubmit
"""</span></pre>
            </div>

            <!-- Build Loop -->
            <div class="code-panel" id="t-loop">
                <button class="cp-btn" onclick="copyTab('t-loop')">COPY</button>
                <pre><span class="c"># build_loop.py ‚Äî how the orchestrator dispatches sub-agents</span>
<span class="c"># Each sub-agent is itself an agentic loop with its own MCP session</span>

<span class="k">async def</span> <span class="n">run_agent</span>(agent_name: str, prompt: str, task: str, session) -> str:
    <span class="s">"""
    Run a specialized agent as its own agentic loop.
    Agent calls MCP tools freely until it outputs its COMPLETE signal.
    """</span>
    <span class="v">messages</span> = [{<span class="s">"role"</span>: <span class="s">"user"</span>, <span class="s">"content"</span>: task}]
    <span class="v">tools</span> = <span class="k">await</span> session.list_tools()

    <span class="k">while True</span>:
        <span class="v">resp</span> = client.messages.create(
            model=<span class="s">"claude-sonnet-4-6"</span>,
            max_tokens=<span class="b">4096</span>,
            system=prompt,
            tools=[t.dict() <span class="k">for</span> t <span class="k">in</span> tools.tools],
            messages=messages
        )

        <span class="v">full_text</span> = <span class="s">""</span>
        <span class="k">for</span> block <span class="k">in</span> resp.content:
            <span class="k">if</span> block.type == <span class="s">"text"</span>:
                full_text += block.text
                print(<span class="s">f"  [{agent_name}]: {block.text[:120]}..."</span>)
            <span class="k">elif</span> block.type == <span class="s">"tool_use"</span>:
                print(<span class="s">f"  [{agent_name}] ‚Üí {block.name}({list(block.input.keys())})"</span>)
                <span class="v">result</span> = <span class="k">await</span> session.call_tool(block.name, block.input)
                messages.append({<span class="s">"role"</span>: <span class="s">"assistant"</span>, <span class="s">"content"</span>: resp.content})
                messages.append({<span class="s">"role"</span>: <span class="s">"user"</span>, <span class="s">"content"</span>: [{
                    <span class="s">"type"</span>: <span class="s">"tool_result"</span>,
                    <span class="s">"tool_use_id"</span>: block.id,
                    <span class="s">"content"</span>: str(result.content)
                }]})

        <span class="c"># Agent signals completion via text output</span>
        <span class="k">if</span> <span class="s">"_COMPLETE"</span> <span class="k">in</span> full_text <span class="k">or</span> resp.stop_reason == <span class="s">"end_turn"</span>:
            <span class="k">return</span> full_text

<span class="c"># ‚îÄ‚îÄ Build Phase Sequence ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ</span>
<span class="k">async def</span> <span class="n">full_build_pipeline</span>(spec: str, session):
    
    <span class="c"># Phase 1: Design</span>
    print(<span class="s">"\nüìê Phase 1: Architecture"</span>)
    <span class="k">await</span> run_agent(<span class="s">"Architect"</span>, ARCHITECT_PROMPT, spec, session)
    <span class="c"># HUMAN GATE: ask_human is called inside the agent via MCP tool</span>

    <span class="c"># Phase 2: Build (parallel where possible)</span>
    print(<span class="s">"\n‚öôÔ∏è  Phase 2: Backend"</span>)
    <span class="k">await</span> run_agent(<span class="s">"BackendDev"</span>, BACKEND_PROMPT,
                    <span class="s">"Implement all backend services per ARCHITECTURE.md"</span>, session)

    print(<span class="s">"\nüé® Phase 3: Frontend"</span>)
    <span class="k">await</span> run_agent(<span class="s">"FrontendDev"</span>, FRONTEND_PROMPT,
                    <span class="s">"Build React dashboard per api_contract.json"</span>, session)

    <span class="c"># Phase 3: QA + Security</span>
    print(<span class="s">"\nüß™ Phase 4: Tests"</span>)
    <span class="k">await</span> run_agent(<span class="s">"Tester"</span>, TESTER_PROMPT, <span class="s">"Write and run full test suite"</span>, session)

    print(<span class="s">"\nüîí Phase 5: Security"</span>)
    <span class="k">await</span> run_agent(<span class="s">"Security"</span>, SECURITY_PROMPT, <span class="s">"Audit all code"</span>, session)

    <span class="c"># Check if security blocked</span>
    <span class="v">state</span> = json.loads(open(<span class="s">"build_state.json"</span>).read())
    <span class="k">if</span> state.get(<span class="s">"MERGE_BLOCKED"</span>):
        print(<span class="s">"\nüö® Security blocked merge. Backend agent fixing..."</span>)
        <span class="k">await</span> run_agent(<span class="s">"BackendDev"</span>, BACKEND_PROMPT,
                        <span class="s">"Fix all CRITICAL issues in security_report.md"</span>, session)

    <span class="c"># Phase 4: Docs</span>
    print(<span class="s">"\nüìù Phase 6: Documentation"</span>)
    <span class="k">await</span> run_agent(<span class="s">"Documenter"</span>, DOC_PROMPT, <span class="s">"Document entire codebase"</span>, session)

    print(<span class="s">"\n‚úÖ BUILD COMPLETE ‚Äî awaiting human review"</span>)</pre>
            </div>

            <!-- State Schema -->
            <div class="code-panel" id="t-state">
                <button class="cp-btn" onclick="copyTab('t-state')">COPY</button>
                <pre><span class="c">// build_state.json ‚Äî shared truth for all agents</span>
<span class="c">// Orchestrator writes this; agents read it to understand current state</span>
{
  <span class="s">"project"</span>: {
    <span class="s">"name"</span>: <span class="s">"media-intelligence-platform"</span>,
    <span class="s">"spec_file"</span>: <span class="s">"PROJECT_SPEC.md"</span>,
    <span class="s">"started_at"</span>: <span class="s">"2026-02-22T12:00:00Z"</span>
  },

  <span class="s">"phases"</span>: {
    <span class="s">"architecture"</span>: <span class="s">"COMPLETE"</span>,    <span class="c">// PENDING | IN_PROGRESS | COMPLETE | BLOCKED</span>
    <span class="s">"backend"</span>:      <span class="s">"IN_PROGRESS"</span>,
    <span class="s">"frontend"</span>:     <span class="s">"PENDING"</span>,
    <span class="s">"testing"</span>:      <span class="s">"PENDING"</span>,
    <span class="s">"security"</span>:     <span class="s">"PENDING"</span>,
    <span class="s">"documentation"</span>:<span class="s">"PENDING"</span>
  },

  <span class="s">"human_gates"</span>: {
    <span class="s">"architecture_approved"</span>: <span class="b">true</span>,
    <span class="s">"security_policy_set"</span>:   <span class="b">false</span>,   <span class="c">// blocks security phase</span>
    <span class="s">"credentials_provided"</span>:  <span class="b">false</span>    <span class="c">// blocks integrations</span>
  },

  <span class="s">"MERGE_BLOCKED"</span>: <span class="b">false</span>,             <span class="c">// Security agent sets this</span>

  <span class="s">"metrics"</span>: {
    <span class="s">"test_coverage"</span>: <span class="b">0</span>,
    <span class="s">"tests_passing"</span>: <span class="b">0</span>,
    <span class="s">"tests_total"</span>:   <span class="b">0</span>,
    <span class="s">"security_issues"</span>: { <span class="s">"critical"</span>: <span class="b">0</span>, <span class="s">"high"</span>: <span class="b">0</span>, <span class="s">"medium"</span>: <span class="b">0</span> },
    <span class="s">"files_written"</span>: <span class="b">0</span>,
    <span class="s">"commits"</span>:       <span class="b">0</span>
  },

  <span class="s">"agent_log"</span>: [
    {
      <span class="s">"agent"</span>:      <span class="s">"Architect"</span>,
      <span class="s">"action"</span>:     <span class="s">"wrote ARCHITECTURE.md"</span>,
      <span class="s">"timestamp"</span>:  <span class="s">"2026-02-22T12:05:00Z"</span>,
      <span class="s">"prompt_ver"</span>: <span class="s">"architect_v1.2"</span>
    }
  ],

  <span class="s">"known_issues"</span>: [],      <span class="c">// agents write issues here for orchestrator</span>
  <span class="s">"completed_modules"</span>: []  <span class="c">// backend/frontend tracks finished pieces</span>
}</pre>
            </div>

            <!-- GitOps Hook -->
            <div class="code-panel" id="t-gitops">
                <button class="cp-btn" onclick="copyTab('t-gitops')">COPY</button>
                <pre><span class="c"># gitops.py ‚Äî auto-commit hook triggered on every file write/edit</span>
<span class="c"># Every change is committed with agent identity + prompt version metadata</span>
<span class="k">import</span> subprocess
<span class="k">from</span> pathlib <span class="k">import</span> Path
<span class="k">from</span> datetime <span class="k">import</span> datetime, timezone

<span class="k">class</span> <span class="n">GitOpsManager</span>:
    <span class="k">def</span> <span class="n">__init__</span>(<span class="v">self</span>, repo_root: str, session_branch: str):
        <span class="v">self</span>.repo = Path(repo_root)
        <span class="v">self</span>.branch = session_branch
        <span class="v">self</span>._ensure_branch()

    <span class="k">def</span> <span class="n">_ensure_branch</span>(<span class="v">self</span>):
        <span class="c"># create feature/session branch if it doesn't exist</span>
        subprocess.run(
            [<span class="s">"git"</span>, <span class="s">"checkout"</span>, <span class="s">"-B"</span>, <span class="v">self</span>.branch],
            cwd=<span class="v">self</span>.repo, check=<span class="b">True</span>
        )

    <span class="k">def</span> <span class="n">commit</span>(
        <span class="v">self</span>,
        file_path: str,
        agent_name: str,
        prompt_version: str,
        prompt_summary: str,
    ) -> str:
        <span class="n">"""Stages the file and commits with structured metadata message."""</span>
        subprocess.run([<span class="s">"git"</span>, <span class="s">"add"</span>, file_path], cwd=<span class="v">self</span>.repo, check=<span class="b">True</span>)

        <span class="v">ts</span> = datetime.now(timezone.utc).isoformat(timespec=<span class="s">"seconds"</span>)
        <span class="v">msg</span> = (
            <span class="s">f"[{agent_name}] {prompt_summary}\n\n"</span>
            <span class="s">f"agent: {agent_name}\n"</span>
            <span class="s">f"prompt_version: {prompt_version}\n"</span>
            <span class="s">f"file: {file_path}\n"</span>
            <span class="s">f"timestamp: {ts}"</span>
        )
        subprocess.run(
            [<span class="s">"git"</span>, <span class="s">"commit"</span>, <span class="s">"-m"</span>, msg],
            cwd=<span class="v">self</span>.repo, check=<span class="b">True</span>
        )
        <span class="k">return</span> msg

<span class="c"># Usage ‚Äî called automatically after every write_file / edit_file tool call</span>
<span class="v">gitops</span> = GitOpsManager(<span class="s">"."</span>, session_branch=<span class="s">"feature/session-2026-02-21"</span>)

<span class="v">gitops</span>.commit(
    file_path=<span class="s">"src/api/routes.py"</span>,
    agent_name=<span class="s">"Developer"</span>,
    prompt_version=<span class="s">"developer_v2.1"</span>,
    prompt_summary=<span class="s">"implement POST /ingest endpoint per SystemDesignPlan"</span>,
)</pre>
            </div>

            <!-- Prompt Versioning -->
            <div class="code-panel" id="t-prompts">
                <button class="cp-btn" onclick="copyTab('t-prompts')">COPY</button>
                <pre><span class="c"># prompts/developer.md ‚Äî agent system prompt as a versioned Markdown file</span>
<span class="c"># Changing this file = a PR. Every version is diff-able and rollback-able.</span>
<span class="c"># ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ</span>
<span class="c"># version: 2.1</span>
<span class="c"># agent: Developer</span>
<span class="c"># model_tier: standard  # sonnet / gpt-4o</span>
<span class="c"># last_updated: 2026-02-21</span>
<span class="c"># ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ</span>

<span class="n">You are a Developer agent in a production-grade multi-agent build system.</span>

<span class="n">## Identity</span>
<span class="n">- You implement code per the SystemDesignPlan.md written by the Architect.</span>
<span class="n">- You only edit files assigned to you by the Lead / PM via FileLockManager.</span>
<span class="n">- You are file-lock aware: NEVER edit a file not in your assigned list.</span>

<span class="n">## Behaviour</span>
<span class="n">- Read SystemDesignPlan.md first on every task.</span>
<span class="n">- Implement in small, testable, committable chunks.</span>
<span class="n">- After each file edit: run execute_code to verify locally before committing.</span>
<span class="n">- If review feedback arrives: read it fully, address ALL items, do not skip.</span>

<span class="n">## Rules</span>
<span class="n">- temp=0.2 ‚Äî be deterministic, not creative.</span>
<span class="n">- Never hallucinate library APIs. Use search_codebase or read_file to verify.</span>
<span class="n">- Never call ask_human unless the spec is genuinely contradictory.</span>
<span class="n">- Every file write triggers an auto-commit ‚Äî do not batch multiple file changes.</span>

<span class="c">---</span>
<span class="c"># config/agents.yaml ‚Äî reference by file path, not inline string</span>
<span class="v">developer</span>:
  <span class="v">prompt_file</span>: <span class="s">"prompts/developer.md"</span>
  <span class="v">prompt_version</span>: <span class="s">"2.1"</span>
  <span class="v">model_tier</span>: <span class="s">"standard"</span>
  <span class="v">tools</span>: [<span class="s">"read_file"</span>, <span class="s">"write_file"</span>, <span class="s">"edit_file"</span>, <span class="s">"execute_code"</span>, <span class="s">"shell"</span>, <span class="s">"search_codebase"</span>]
  <span class="v">max_iterations</span>: <span class="b">12</span>
  <span class="v">temperature</span>: <span class="b">0.2</span></pre>
            </div>

        </div>

        <!-- Risk Register -->
        <div class="sec" id="risks">
            <div class="sec-title"><span>05</span> ‚Äî Agentic AI Risk Register</div>
            <div class="risk-grid">

                <div class="risk-card">
                    <div class="severity sev-critical">‚¨õ CRITICAL</div>
                    <h4>Error Propagation</h4>
                    <p>A flawed architectural decision or incorrect code module silently infects downstream agents
                        that rely on the same shared state. Errors compound across phases before being caught.</p>
                    <div class="mitigation">‚Üí 3-reviewer parallel gates at every phase boundary. Architecture must
                        achieve 3/3 approval; code and fixes require 2/3. Each gate blocks progression until
                        resolved.</div>
                    <span class="risk-status status-planned">Planned</span>
                </div>

                <div class="risk-card">
                    <div class="severity sev-high">‚ö† HIGH</div>
                    <h4>Cost Explosion</h4>
                    <p>Agents in tight retry loops with large context windows consume thousands of tokens per
                        iteration. A single failed P0 bug fix loop can exhaust a session budget.</p>
                    <div class="mitigation">‚Üí Model tiering: Reasoning tier (Opus/o1) only for planning; Standard
                        (Sonnet) for dev/review; Fast (Haiku) for docs/tests. Budget tracker with real-time
                        alerts. P3 bugs deferred ‚Äî never debugged in-session.</div>
                    <span class="risk-status status-planned">Planned</span>
                </div>

                <div class="risk-card">
                    <div class="severity sev-med">‚óã MEDIUM</div>
                    <h4>Latency Accumulation</h4>
                    <p>Sequential agent chains with multiple LLM calls per phase create end-to-end latency that
                        makes the system unusable for interactive development loops.</p>
                    <div class="mitigation">‚Üí DAG-based orchestration with parallel branches. Phase 2 runs
                        Developer √ó N and Doc Agent concurrently. Review Gate uses 3 reviewers in parallel.
                        Fast-tier model for Tester and Doc Agent.</div>
                    <span class="risk-status status-planned">Planned</span>
                </div>

                <div class="risk-card">
                    <div class="severity sev-high">‚ö† HIGH</div>
                    <h4>Non-Determinism</h4>
                    <p>High temperature settings cause agents to produce different code or decisions on identical
                        inputs, making bugs unreproducible and reviews inconsistent.</p>
                    <div class="mitigation">‚Üí All agents run at temp=0.2. Pydantic v2 enforces structured output
                        schemas for all agent outputs (RefinedSpec, BugReport, ReviewVerdict). Validation layer
                        rejects malformed outputs before they enter shared state.</div>
                    <span class="risk-status status-built">Built</span>
                </div>

                <div class="risk-card">
                    <div class="severity sev-high">‚ö† HIGH</div>
                    <h4>Context Window Exhaustion</h4>
                    <p>Agents that accumulate full conversation history across a long session hit token limits
                        and begin hallucinating or truncating critical context.</p>
                    <div class="mitigation">‚Üí Sliding context window with configurable token budget per agent.
                        Auto-summarization triggers when window approaches limit. Agents never load full codebase
                        ‚Äî request specific files via read_file tool only.</div>
                    <span class="risk-status status-built">Built</span>
                </div>

                <div class="risk-card">
                    <div class="severity sev-critical">‚¨õ CRITICAL</div>
                    <h4>Prompt Injection</h4>
                    <p>Malicious content in source files, user input, or tool outputs causes an agent to
                        override its system prompt, exfiltrate data, or execute unintended commands.</p>
                    <div class="mitigation">‚Üí Guardrails layer scans all tool outputs before injecting into
                        agent context. Tool output schema validation rejects unexpected content shapes.
                        Per-agent tool permission matrix ‚Äî agents can only call their allowed tools.</div>
                    <span class="risk-status status-planned">Planned</span>
                </div>

                <div class="risk-card">
                    <div class="severity sev-critical">‚¨õ CRITICAL</div>
                    <h4>Tool Misuse / Destructive Actions</h4>
                    <p>An agent calls shell or write_file with a destructive path (e.g., deletes unrelated
                        files, runs <code>rm -rf</code>, or overwrites configuration outside its scope).</p>
                    <div class="mitigation">‚Üí All code execution in Docker sandbox with resource limits. Path
                        guard enforces workspace containment ‚Äî no writes outside project root. Per-agent
                        permission matrix restricts tool access by role (e.g., Doc Agent cannot call shell).</div>
                    <span class="risk-status status-planned">Planned</span>
                </div>

                <div class="risk-card">
                    <div class="severity sev-high">‚ö† HIGH</div>
                    <h4>Identity Explosion / Secret Leak</h4>
                    <p>An agent receives or generates API keys, passwords, or tokens and writes them to a file
                        that gets committed to the git history or logged in plaintext.</p>
                    <div class="mitigation">‚Üí Secrets manager integration ‚Äî credentials never appear in agent
                        context. GitOps hook scans commit diffs for secret patterns before writing. Agents are
                        explicitly instructed: never generate, store, or transmit credentials.</div>
                    <span class="risk-status status-planned">Planned</span>
                </div>

                <div class="risk-card">
                    <div class="severity sev-high">‚ö† HIGH</div>
                    <h4>Observability Gaps</h4>
                    <p>When multi-agent pipelines fail silently or produce wrong output, the absence of
                        structured traces makes root-cause diagnosis nearly impossible.</p>
                    <div class="mitigation">‚Üí OpenTelemetry spans per agent and per tool call. structlog for
                        structured JSON logs. Prometheus metrics for token spend, latency, retry rates. Full
                        git audit trail: every file change committed with agent name + prompt version.</div>
                    <span class="risk-status status-planned">Planned</span>
                </div>

                <div class="risk-card">
                    <div class="severity sev-high">‚ö† HIGH</div>
                    <h4>Deadlocks / Infinite Loops</h4>
                    <p>Two agents waiting on each other's output (DAG cycle), or a single agent looping on a
                        fix that continuously fails validation, stalls the entire pipeline indefinitely.</p>
                    <div class="mitigation">‚Üí max_iterations hard cap per agent (default 12). Per-node timeout
                        in the DAG executor. Deadlock detection on graph cycles at build time. On 3+ consecutive
                        failures, Lead auto-escalates to human via ask_human.</div>
                    <span class="risk-status status-built">Built</span>
                </div>

                <div class="risk-card">
                    <div class="severity sev-med">‚óã MEDIUM</div>
                    <h4>Feedback Loop Poisoning</h4>
                    <p>Incorrect task outcomes (hallucinated successes, false test passes) stored in episodic
                        memory contaminate future agent decisions that draw on past experience.</p>
                    <div class="mitigation">‚Üí Episodic memory entries validated before storage ‚Äî only outcomes
                        that passed the review gate are recorded. Episode scoring tracks accuracy over time.
                        Poisoned episodes can be flagged and excluded.</div>
                    <span class="risk-status status-built">Built</span>
                </div>

                <div class="risk-card">
                    <div class="severity sev-high">‚ö† HIGH</div>
                    <h4>Provider Outage / Rate Limits</h4>
                    <p>Mid-pipeline LLM provider outage or rate limit causes agent failure with no recovery
                        path, losing hours of build progress and requiring manual restart.</p>
                    <div class="mitigation">‚Üí Multi-provider fallback: OpenAI ‚Üî Anthropic switchover on
                        provider error. Tenacity exponential backoff with jitter on rate limit responses.
                        Build state persisted to disk ‚Äî pipeline resumes from last completed node, not from
                        scratch.</div>
                    <span class="risk-status status-built">Built</span>
                </div>

            </div>
        </div>

        <!-- Footer -->
        <div
            style="border-top:1px solid var(--border2); margin-top:48px; padding-top:20px; display:flex; justify-content:space-between; align-items:center;">
            <span style="font-family:'IBM Plex Mono',monospace; font-size:11px; color:var(--dim);">LIVINGAI ¬∑ TEAM B ¬∑
                AUTONOMOUS BUILD SYSTEM</span>
            <span style="font-family:'IBM Plex Mono',monospace; font-size:11px; color:var(--dim);">TEAM B: AMEY ¬∑ SAIRAJ
                ¬∑ CHANDRESH</span>
        </div>

    </div>

    <script>
        function showTab(e, id) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.code-panel').forEach(p => p.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            e.target.classList.add('active');
        }

        function copyTab(id) {
            const pre = document.getElementById(id).querySelector('pre');
            navigator.clipboard.writeText(pre.innerText).then(() => {
                const btn = document.getElementById(id).querySelector('.cp-btn');
                btn.textContent = 'COPIED!';
                btn.style.color = '#7ee787';
                setTimeout(() => { btn.textContent = 'COPY'; btn.style.color = ''; }, 2000);
            });
        }
    </script>
</body>

</html>